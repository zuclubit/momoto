<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Momoto Engine â€” Chromatic Intelligence API</title>
  <meta name="description" content="Momoto is a Rust/WASM chromatic intelligence engine: perceptual color science, WCAG/APCA accessibility, glass physics, AI color recommendations. Momoto decides. Momoto UI renders." />
  <meta property="og:title" content="Momoto Engine â€” Chromatic Intelligence" />
  <meta property="og:description" content="Rust/WASM engine for perceptual color science, accessibility metrics, glass physics, and AI color recommendations." />
  <meta property="og:image" content="assets/momoto-ui-geno1.png" />
  <meta property="og:url" content="https://zuclubit.github.io/momoto-ui/" />
  <meta name="twitter:card" content="summary_large_image" />
  <link rel="canonical" href="https://zuclubit.github.io/momoto-ui/" />
  <style>
    /* â”€â”€ DESIGN TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      /* Brand */
      --m-bg:          #07070e;
      --m-bg-alt:      #0d0d18;
      --m-surface:     #111122;
      --m-surface-2:   #171730;
      --m-border:      rgba(255,255,255,0.08);
      --m-border-glow: rgba(108,99,255,0.35);

      /* Accent gradient: indigo â†’ violet â†’ blue */
      --m-grad: linear-gradient(135deg, oklch(0.62 0.22 265) 0%, oklch(0.58 0.28 300) 50%, oklch(0.64 0.2 245) 100%);
      --m-grad-text: linear-gradient(135deg, #fff 0%, oklch(0.82 0.18 265) 50%, oklch(0.78 0.2 310) 100%);

      --m-accent:  oklch(0.62 0.22 265);
      --m-violet:  oklch(0.58 0.28 300);
      --m-blue:    oklch(0.64 0.2 245);
      --m-green:   oklch(0.73 0.17 155);
      --m-amber:   oklch(0.80 0.16 80);
      --m-red:     oklch(0.60 0.20 25);

      --m-text:    #eeeef8;
      --m-text-2:  #9898b8;
      --m-text-3:  #555578;

      --m-mono: 'JetBrains Mono', 'Cascadia Code', 'Fira Code', ui-monospace, monospace;
      --m-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', system-ui, sans-serif;

      --m-radius: 12px;
      --m-radius-sm: 8px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; color-scheme: dark; }
    body {
      font-family: var(--m-sans);
      background: var(--m-bg);
      color: var(--m-text);
      line-height: 1.65;
      overflow-x: hidden;
    }

    /* â”€â”€ NOISE TEXTURE OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    body::before {
      content: '';
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      opacity: 0.025;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    }

    /* â”€â”€ STICKY HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      position: sticky; top: 0; z-index: 200;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 2rem; height: 58px;
      background: rgba(7,7,14,0.75);
      backdrop-filter: blur(24px) saturate(200%);
      border-bottom: 1px solid var(--m-border);
    }
    .logo {
      display: flex; align-items: center; gap: 10px;
      text-decoration: none; user-select: none;
    }
    .logo-mark {
      width: 30px; height: 30px; border-radius: 9px;
      background: var(--m-grad);
      display: flex; align-items: center; justify-content: center;
      font-weight: 900; font-size: 15px; color: white;
      letter-spacing: -0.05em;
      box-shadow: 0 0 20px rgba(108,99,255,0.4);
    }
    .logo-name {
      font-size: 16px; font-weight: 800;
      background: var(--m-grad-text);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      letter-spacing: -0.03em;
    }
    .logo-tagline {
      font-size: 11px; color: var(--m-text-3); font-family: var(--m-mono);
      margin-top: 1px;
    }
    .logo-info { display: flex; flex-direction: column; }
    .header-badge {
      font-size: 10px; padding: 2px 8px; border-radius: 999px;
      background: var(--m-surface-2); border: 1px solid var(--m-border);
      color: var(--m-text-3); font-family: var(--m-mono);
    }
    nav { display: flex; align-items: center; gap: 6px; }
    .nav-link {
      padding: 6px 14px; border-radius: var(--m-radius-sm); font-size: 13px; font-weight: 500;
      color: var(--m-text-2); text-decoration: none; transition: all .2s;
    }
    .nav-link:hover { color: var(--m-text); background: var(--m-surface); }
    .nav-cta {
      padding: 6px 16px; border-radius: var(--m-radius-sm); font-size: 13px; font-weight: 600;
      background: var(--m-grad); color: white; text-decoration: none;
      box-shadow: 0 0 16px rgba(108,99,255,0.3);
      transition: all .2s;
    }
    .nav-cta:hover { box-shadow: 0 0 28px rgba(108,99,255,0.5); transform: translateY(-1px); }

    /* â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hero {
      position: relative; z-index: 1;
      padding: 7rem 2rem 5rem;
      text-align: center; overflow: hidden;
    }
    /* Radial glow behind hero */
    .hero::before {
      content: '';
      position: absolute; top: -200px; left: 50%; transform: translateX(-50%);
      width: 900px; height: 600px; border-radius: 50%;
      background: radial-gradient(ellipse, rgba(108,99,255,0.12) 0%, transparent 70%);
      pointer-events: none;
    }
    .hero-eyebrow {
      display: inline-flex; align-items: center; gap: 8px;
      background: rgba(108,99,255,0.08);
      border: 1px solid rgba(108,99,255,0.25);
      border-radius: 999px; padding: 5px 16px;
      font-size: 12px; font-family: var(--m-mono);
      color: oklch(0.75 0.16 265);
      margin-bottom: 1.75rem; letter-spacing: 0.04em;
    }
    .hero-eyebrow::before { content: 'â¬¡'; font-size: 10px; }
    h1 {
      font-size: clamp(2.8rem, 7vw, 5.2rem);
      font-weight: 900; letter-spacing: -0.05em; line-height: 1.05;
      background: var(--m-grad-text);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      margin-bottom: 1.25rem;
    }
    .hero-sub {
      font-size: clamp(1rem, 2vw, 1.2rem); color: var(--m-text-2);
      max-width: 580px; margin: 0 auto 0.75rem; line-height: 1.6;
    }
    .hero-tagline {
      font-family: var(--m-mono); font-size: 14px; color: var(--m-text-3);
      margin-bottom: 2.5rem; letter-spacing: 0.06em;
    }
    .hero-tagline strong { color: var(--m-accent); font-weight: 600; }
    .hero-actions {
      display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;
      margin-bottom: 3.5rem;
    }
    .btn {
      padding: 11px 24px; border-radius: var(--m-radius-sm); font-size: 14px; font-weight: 600;
      text-decoration: none; display: inline-flex; align-items: center; gap: 7px;
      transition: all .22s; cursor: pointer; border: none; font-family: inherit;
    }
    .btn-primary {
      background: var(--m-grad); color: white;
      box-shadow: 0 0 20px rgba(108,99,255,0.35), 0 1px 2px rgba(0,0,0,0.5);
    }
    .btn-primary:hover { box-shadow: 0 0 35px rgba(108,99,255,0.55); transform: translateY(-2px); }
    .btn-ghost {
      background: var(--m-surface); border: 1px solid var(--m-border);
      color: var(--m-text);
    }
    .btn-ghost:hover { border-color: rgba(255,255,255,0.2); background: var(--m-surface-2); }

    /* â”€â”€ HERO STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hero-stats {
      display: flex; justify-content: center; gap: clamp(2rem, 5vw, 4.5rem);
      padding: 1.5rem 2rem; flex-wrap: wrap;
    }
    .stat { text-align: center; }
    .stat-n {
      font-size: clamp(1.8rem, 4vw, 2.5rem); font-weight: 900;
      font-family: var(--m-mono); letter-spacing: -0.05em;
      background: var(--m-grad-text);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .stat-l { font-size: 11px; color: var(--m-text-3); text-transform: uppercase; letter-spacing: 0.1em; margin-top: 2px; }

    /* â”€â”€ DIVIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .divider {
      height: 1px; background: linear-gradient(90deg, transparent, var(--m-border), transparent);
      margin: 0;
    }

    /* â”€â”€ SECTION WRAPPER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    section {
      position: relative; z-index: 1;
      padding: 5rem 2rem;
      max-width: 1200px; margin: 0 auto;
    }
    .section-label {
      font-size: 11px; font-family: var(--m-mono); letter-spacing: 0.14em; text-transform: uppercase;
      color: var(--m-accent); margin-bottom: 0.75rem;
    }
    h2 {
      font-size: clamp(1.8rem, 4vw, 2.8rem); font-weight: 800;
      letter-spacing: -0.04em; line-height: 1.15; color: var(--m-text);
      margin-bottom: 1rem;
    }
    h2 span {
      background: var(--m-grad-text);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .section-desc { font-size: 1.05rem; color: var(--m-text-2); max-width: 640px; margin-bottom: 3rem; }

    /* â”€â”€ VISUAL DIAGRAMS SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .diagrams-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }
    .diagram-card {
      position: relative; border-radius: 20px; overflow: hidden;
      border: 1px solid var(--m-border);
      background: var(--m-surface);
      box-shadow: 0 0 0 1px transparent, 0 4px 40px rgba(0,0,0,0.4);
      transition: all .3s;
      cursor: pointer;
    }
    .diagram-card:hover {
      border-color: var(--m-border-glow);
      box-shadow: 0 0 0 1px rgba(108,99,255,0.15), 0 8px 60px rgba(0,0,0,0.5), 0 0 40px rgba(108,99,255,0.08);
      transform: translateY(-4px);
    }
    .diagram-card img {
      width: 100%; height: auto; display: block;
      border-radius: 20px 20px 0 0;
      filter: saturate(0.95) brightness(0.97);
      transition: filter .3s;
    }
    .diagram-card:hover img { filter: saturate(1.05) brightness(1); }
    .diagram-caption {
      padding: 1.25rem 1.5rem;
      border-top: 1px solid var(--m-border);
    }
    .diagram-caption h3 {
      font-size: 15px; font-weight: 700; color: var(--m-text);
      margin-bottom: 4px; letter-spacing: -0.02em;
    }
    .diagram-caption p { font-size: 13px; color: var(--m-text-2); line-height: 1.5; }
    .diagram-tag {
      display: inline-flex; align-items: center; gap: 5px;
      font-size: 10px; font-family: var(--m-mono);
      padding: 2px 8px; border-radius: 999px;
      background: rgba(108,99,255,0.08); border: 1px solid rgba(108,99,255,0.2);
      color: oklch(0.72 0.15 265); margin-top: 8px;
    }
    .diagram-tag::before { content: 'â¬¡'; font-size: 9px; }

    /* â”€â”€ FULLSCREEN IMAGE MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modal-overlay {
      display: none; position: fixed; inset: 0; z-index: 1000;
      background: rgba(0,0,0,0.92);
      backdrop-filter: blur(12px);
      align-items: center; justify-content: center; padding: 2rem;
      cursor: zoom-out;
    }
    .modal-overlay.open { display: flex; }
    .modal-img {
      max-width: 90vw; max-height: 90vh;
      border-radius: 16px;
      box-shadow: 0 0 80px rgba(108,99,255,0.2);
    }
    .modal-close {
      position: fixed; top: 1.5rem; right: 1.5rem;
      width: 40px; height: 40px; border-radius: 50%;
      background: var(--m-surface-2); border: 1px solid var(--m-border);
      color: var(--m-text-2); cursor: pointer; font-size: 18px;
      display: flex; align-items: center; justify-content: center;
    }

    /* â”€â”€ MODULES GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modules-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem;
    }
    .module-card {
      background: var(--m-surface); border: 1px solid var(--m-border);
      border-radius: var(--m-radius); padding: 1.5rem;
      transition: all .2s; position: relative; overflow: hidden;
    }
    .module-card::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
      background: var(--m-grad); opacity: 0; transition: opacity .3s;
    }
    .module-card:hover { border-color: rgba(108,99,255,0.3); transform: translateY(-2px); }
    .module-card:hover::before { opacity: 1; }
    .module-icon {
      width: 40px; height: 40px; border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px; margin-bottom: 1rem;
      background: var(--m-surface-2); border: 1px solid var(--m-border);
    }
    .module-card h3 {
      font-size: 15px; font-weight: 700; color: var(--m-text);
      margin-bottom: 6px; letter-spacing: -0.02em;
    }
    .module-card p { font-size: 13px; color: var(--m-text-2); line-height: 1.5; }
    .module-count {
      display: inline-block; margin-top: 10px;
      font-size: 10px; font-family: var(--m-mono);
      padding: 2px 7px; border-radius: 4px;
      background: var(--m-surface-2); color: var(--m-text-3);
    }

    /* â”€â”€ SEARCH & API EXPLORER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .search-row {
      display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; align-items: center;
    }
    .search-wrap { position: relative; flex: 1; min-width: 260px; }
    .search-wrap input {
      width: 100%; padding: 11px 16px 11px 44px;
      background: var(--m-surface); border: 1px solid var(--m-border);
      border-radius: var(--m-radius-sm); color: var(--m-text); font-size: 14px; font-family: inherit;
      outline: none; transition: border-color .2s;
    }
    .search-wrap input:focus { border-color: var(--m-accent); box-shadow: 0 0 0 3px rgba(108,99,255,0.1); }
    .search-wrap input::placeholder { color: var(--m-text-3); }
    .search-icon {
      position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
      color: var(--m-text-3); font-size: 17px; pointer-events: none;
    }
    .filter-pills { display: flex; gap: 6px; flex-wrap: wrap; }
    .pill {
      padding: 6px 14px; border-radius: 999px; font-size: 12px; font-weight: 500;
      border: 1px solid var(--m-border); color: var(--m-text-2);
      cursor: pointer; transition: all .15s; background: none; font-family: inherit;
    }
    .pill:hover { border-color: rgba(255,255,255,0.2); color: var(--m-text); }
    .pill.active { background: var(--m-grad); border-color: transparent; color: white; box-shadow: 0 0 12px rgba(108,99,255,0.3); }

    /* â”€â”€ API CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .api-grid { display: flex; flex-direction: column; gap: 8px; }
    .api-card {
      background: var(--m-surface); border: 1px solid var(--m-border);
      border-radius: var(--m-radius-sm); overflow: hidden; transition: border-color .2s;
    }
    .api-card:hover { border-color: rgba(108,99,255,0.25); }
    .api-card-header {
      padding: 0.85rem 1.15rem; cursor: pointer;
      display: flex; align-items: center; gap: 12px;
      user-select: none;
    }
    .api-card-header:hover { background: var(--m-surface-2); }
    .type-pill {
      flex-shrink: 0; font-size: 10px; font-family: var(--m-mono);
      padding: 2px 7px; border-radius: 4px; border: 1px solid;
    }
    .type-fn    { color: oklch(0.75 0.18 155); border-color: rgba(100,220,140,0.25); background: rgba(100,220,140,0.06); }
    .type-class { color: oklch(0.75 0.15 275); border-color: rgba(120,100,255,0.25); background: rgba(120,100,255,0.06); }
    .api-sig {
      font-family: var(--m-mono); font-size: 13px; flex: 1;
      color: var(--m-text); overflow: hidden; white-space: nowrap; text-overflow: ellipsis;
    }
    .sig-name  { color: oklch(0.80 0.18 155); }
    .sig-class { color: oklch(0.76 0.16 265); }
    .sig-ret   { color: oklch(0.72 0.14 45); }
    .sig-param { color: var(--m-text-2); }
    .api-desc-short { font-size: 12px; color: var(--m-text-3); flex-shrink: 0; max-width: 280px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .chevron { color: var(--m-text-3); transition: transform .2s; flex-shrink: 0; font-size: 12px; }
    .api-card.open .chevron { transform: rotate(90deg); }
    .api-card-body {
      display: none; padding: 1rem 1.15rem; border-top: 1px solid var(--m-border);
      background: rgba(7,7,14,0.6);
    }
    .api-card.open .api-card-body { display: block; }
    .api-full-desc { font-size: 13px; color: var(--m-text-2); margin-bottom: 0.75rem; line-height: 1.6; }
    .api-params { margin-bottom: 0.75rem; }
    .api-params-title { font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--m-text-3); margin-bottom: 6px; }
    .param-row { display: flex; gap: 0; font-size: 12px; margin-bottom: 3px; }
    .param-name { font-family: var(--m-mono); color: var(--m-text); min-width: 120px; }
    .param-type { font-family: var(--m-mono); color: oklch(0.65 0.12 200); min-width: 100px; }
    .param-desc { color: var(--m-text-2); }
    .api-returns { display: flex; align-items: baseline; gap: 8px; margin-bottom: 6px; }
    .returns-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.08em; color: var(--m-text-3); }
    .returns-val { font-family: var(--m-mono); font-size: 12px; color: oklch(0.72 0.14 45); }
    .api-standard { font-size: 11px; color: var(--m-text-3); margin-bottom: 6px; }
    .api-note {
      font-size: 12px; color: oklch(0.72 0.15 265); margin-bottom: 0.75rem;
      padding: 6px 10px; border-radius: 6px;
      background: rgba(108,99,255,0.06); border: 1px solid rgba(108,99,255,0.15);
    }
    .code-block {
      background: #050510; border: 1px solid var(--m-border); border-radius: 8px;
      padding: 0.85rem 1rem; font-family: var(--m-mono); font-size: 12px;
      color: #c8d0e0; overflow-x: auto; position: relative;
    }
    .copy-btn {
      position: absolute; top: 6px; right: 8px;
      padding: 3px 9px; font-size: 11px; font-family: var(--m-mono);
      background: var(--m-surface-2); border: 1px solid var(--m-border);
      color: var(--m-text-3); border-radius: 4px; cursor: pointer; transition: all .2s;
    }
    .copy-btn:hover { color: var(--m-text); background: var(--m-surface); }

    /* â”€â”€ QUICKSTART SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .qs-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(480px, 1fr)); gap: 1rem; }
    .qs-card {
      border-radius: var(--m-radius); overflow: hidden;
      border: 1px solid var(--m-border); background: var(--m-surface);
    }
    .qs-header {
      padding: 1rem 1.25rem; border-bottom: 1px solid var(--m-border);
      display: flex; align-items: center; gap: 10px;
    }
    .qs-num {
      width: 22px; height: 22px; border-radius: 6px;
      background: var(--m-grad); display: flex; align-items: center; justify-content: center;
      font-size: 11px; font-weight: 800; color: white; flex-shrink: 0;
    }
    .qs-title { font-size: 14px; font-weight: 600; color: var(--m-text); }
    .qs-desc { font-size: 12px; color: var(--m-text-3); margin-left: auto; }

    /* â”€â”€ PHYSICS PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .physics-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(190px, 1fr)); gap: 1rem; }
    .physics-card {
      background: var(--m-surface); border: 1px solid var(--m-border);
      border-radius: var(--m-radius-sm); padding: 1.1rem 1.25rem;
      transition: border-color .2s;
    }
    .physics-card:hover { border-color: rgba(108,99,255,0.25); }
    .physics-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--m-text-3); margin-bottom: 0.6rem; }
    .physics-vals { font-family: var(--m-mono); font-size: 13px; line-height: 1.8; }
    .physics-vals span { color: var(--m-text-2); font-size: 12px; }

    /* â”€â”€ ARCHITECTURE DIAGRAM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .arch-box {
      background: var(--m-surface); border: 1px solid var(--m-border);
      border-radius: var(--m-radius); padding: 1.75rem 2rem;
      font-family: var(--m-mono); font-size: 12.5px; line-height: 1.85;
      color: var(--m-text-2); overflow-x: auto; white-space: pre;
    }
    .arch-accent { color: var(--m-accent); }
    .arch-green  { color: var(--m-green); }
    .arch-violet { color: var(--m-violet); }

    /* â”€â”€ INSTALL CALLOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .install-box {
      background: var(--m-surface); border: 1px solid var(--m-border-glow);
      border-radius: var(--m-radius); padding: 1.5rem 2rem;
      display: flex; align-items: center; gap: 2rem; flex-wrap: wrap;
      margin-bottom: 2rem;
      box-shadow: 0 0 30px rgba(108,99,255,0.05);
    }
    .install-box code {
      font-family: var(--m-mono); font-size: 14px;
      color: oklch(0.75 0.15 265);
      background: rgba(108,99,255,0.06); padding: 4px 10px; border-radius: 6px;
    }
    .install-note { font-size: 12px; color: var(--m-text-3); }

    /* â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    footer {
      border-top: 1px solid var(--m-border);
      padding: 3rem 2rem;
      text-align: center;
      position: relative; z-index: 1;
    }
    .footer-logo {
      display: flex; align-items: center; justify-content: center; gap: 10px;
      margin-bottom: 1.5rem;
    }
    .footer-tagline {
      font-size: 18px; font-weight: 800; letter-spacing: -0.03em;
      background: var(--m-grad-text);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .footer-links { display: flex; justify-content: center; gap: 1.5rem; flex-wrap: wrap; margin-bottom: 1rem; }
    .footer-links a {
      font-size: 13px; color: var(--m-text-2); text-decoration: none; transition: color .2s;
    }
    .footer-links a:hover { color: var(--m-text); }
    .footer-copy { font-size: 12px; color: var(--m-text-3); }
    .footer-standards {
      font-size: 11px; color: var(--m-text-3); font-family: var(--m-mono);
      margin-top: 6px; letter-spacing: 0.04em;
    }

    /* â”€â”€ PIPELINE DEMO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .pipeline { display: flex; flex-direction: column; gap: 0; }
    .pipeline-step {
      border: 1px solid var(--m-border); border-radius: var(--m-radius);
      background: var(--m-surface); overflow: hidden; margin-bottom: 8px;
      transition: border-color .2s;
    }
    .pipeline-step.active { border-color: var(--m-border-glow); }
    .pipeline-step-header {
      display: flex; align-items: center; gap: 14px;
      padding: 1rem 1.25rem; cursor: pointer; user-select: none;
    }
    .pipeline-step-header:hover { background: var(--m-surface-2); }
    .step-num {
      width: 28px; height: 28px; border-radius: 8px; flex-shrink: 0;
      background: var(--m-grad); display: flex; align-items: center; justify-content: center;
      font-size: 12px; font-weight: 800; color: white;
    }
    .pipeline-step.active .step-num { box-shadow: 0 0 12px rgba(108,99,255,0.5); }
    .step-label { font-size: 14px; font-weight: 700; color: var(--m-text); flex: 1; }
    .step-tag {
      font-family: var(--m-mono); font-size: 10px; padding: 2px 8px;
      border-radius: 999px; background: var(--m-surface-2);
      border: 1px solid var(--m-border); color: var(--m-text-3);
    }
    .pipeline-step.active .step-tag { border-color: rgba(108,99,255,0.3); color: oklch(0.75 0.15 265); }
    .step-arrow { color: var(--m-text-3); transition: transform .2s; font-size: 12px; }
    .pipeline-step.active .step-arrow { transform: rotate(90deg); }
    .pipeline-body {
      display: none; padding: 1.25rem 1.5rem;
      border-top: 1px solid var(--m-border); background: rgba(7,7,14,.6);
    }
    .pipeline-step.active .pipeline-body { display: block; }

    /* Color swatch row */
    .swatch-row { display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem; }
    .swatch { width: 48px; height: 48px; border-radius: 10px; border: 1px solid var(--m-border); flex-shrink: 0; }
    .swatch-info { font-family: var(--m-mono); font-size: 13px; line-height: 1.9; }
    .swatch-hex { font-size: 16px; font-weight: 700; color: var(--m-text); }
    .swatch-sub { color: var(--m-text-3); font-size: 12px; }

    /* Color space cards */
    .cs-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(190px, 1fr)); gap: 10px; margin-bottom: 1rem; }
    .cs-card {
      background: var(--m-surface-2); border: 1px solid var(--m-border);
      border-radius: var(--m-radius-sm); padding: 0.9rem 1.1rem;
    }
    .cs-name { font-size: 10px; text-transform: uppercase; letter-spacing: .1em; color: var(--m-text-3); margin-bottom: 6px; }
    .cs-vals { font-family: var(--m-mono); font-size: 13px; line-height: 1.8; color: var(--m-text-2); }
    .cs-vals b { color: var(--m-accent); }

    /* Metric bars */
    .metric-row { margin-bottom: 12px; }
    .metric-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 4px; }
    .metric-name { font-size: 12px; color: var(--m-text-2); }
    .metric-val { font-family: var(--m-mono); font-size: 13px; font-weight: 700; }
    .metric-bar-wrap { height: 8px; background: var(--m-surface-2); border-radius: 999px; overflow: hidden; }
    .metric-bar { height: 100%; border-radius: 999px; transition: width 0.6s ease; }
    .bar-fail { background: var(--m-red); }
    .bar-warn { background: var(--m-amber); }
    .bar-pass { background: var(--m-green); }
    .badge { display: inline-flex; align-items: center; gap: 4px; padding: 2px 9px; border-radius: 999px; font-size: 11px; font-weight: 700; font-family: var(--m-mono); }
    .badge-fail { background: rgba(220,60,60,.1); border: 1px solid rgba(220,60,60,.25); color: var(--m-red); }
    .badge-pass { background: rgba(60,180,100,.1); border: 1px solid rgba(60,180,100,.25); color: var(--m-green); }

    /* Neural diff */
    .neural-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; margin-bottom: 1rem; }
    .neural-card {
      background: var(--m-surface-2); border: 1px solid var(--m-border);
      border-radius: var(--m-radius-sm); padding: .85rem 1rem; text-align: center;
    }
    .neural-delta { font-family: var(--m-mono); font-size: 18px; font-weight: 800; color: var(--m-accent); }
    .neural-label { font-size: 11px; color: var(--m-text-3); margin-top: 3px; }

    /* Tonal palette swatches */
    .tonal-row { display: flex; gap: 4px; flex-wrap: wrap; margin-top: .75rem; }
    .tone-swatch {
      flex: 1; min-width: 36px; height: 44px; border-radius: 8px;
      border: 1px solid rgba(255,255,255,.06); cursor: pointer;
      transition: transform .15s; position: relative;
    }
    .tone-swatch:hover { transform: scaleY(1.12); z-index: 1; }
    .tone-label { text-align: center; font-size: 9px; color: var(--m-text-3); margin-top: 3px; font-family: var(--m-mono); }

    /* â”€â”€ CODE VIEWER (Rustâ†’WASMâ†’TS) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .code-viewer { border: 1px solid var(--m-border); border-radius: var(--m-radius); overflow: hidden; }
    .code-tabs { display: flex; border-bottom: 1px solid var(--m-border); background: var(--m-surface-2); }
    .code-tab {
      padding: 10px 20px; font-size: 12px; font-weight: 600; cursor: pointer;
      border: none; background: none; color: var(--m-text-3); font-family: var(--m-mono);
      border-bottom: 2px solid transparent; transition: all .2s; white-space: nowrap;
    }
    .code-tab:hover { color: var(--m-text-2); }
    .code-tab.active { color: var(--m-accent); border-bottom-color: var(--m-accent); background: var(--m-surface); }
    .code-panel { display: none; }
    .code-panel.active { display: block; }
    .code-panel-inner {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    }
    .code-col { border-right: 1px solid var(--m-border); }
    .code-col:last-child { border-right: none; }
    .code-col-header {
      padding: 8px 14px; border-bottom: 1px solid var(--m-border);
      background: var(--m-surface-2); font-size: 11px; font-family: var(--m-mono);
      display: flex; align-items: center; gap: 8px;
    }
    .code-lang-badge {
      padding: 1px 7px; border-radius: 4px; font-size: 10px; font-weight: 700;
    }
    .lang-rust { background: rgba(255,120,60,.12); color: #ff784b; border: 1px solid rgba(255,120,60,.2); }
    .lang-wasm { background: rgba(100,99,255,.12); color: oklch(0.72 0.18 265); border: 1px solid rgba(100,99,255,.2); }
    .lang-ts { background: rgba(60,160,255,.12); color: #4aaeff; border: 1px solid rgba(60,160,255,.2); }
    .code-col pre {
      margin: 0; padding: 1rem 1.25rem;
      font-family: var(--m-mono); font-size: 11.5px; line-height: 1.75;
      color: #c8d0e0; overflow-x: auto; white-space: pre;
      background: #050510;
    }
    /* Syntax tokens */
    .tk-kw  { color: #c792ea; }
    .tk-fn  { color: #82aaff; }
    .tk-ty  { color: #ffcb6b; }
    .tk-st  { color: #c3e88d; }
    .tk-cm  { color: #546e7a; font-style: italic; }
    .tk-nm  { color: #f78c6c; }
    .tk-at  { color: #89ddff; }

    /* Flow arrow between pipeline connector */
    .flow-arrow {
      display: flex; align-items: center; justify-content: center;
      color: var(--m-text-3); font-size: 11px; font-family: var(--m-mono);
      padding: 4px 0 2px; letter-spacing: .05em;
    }

    /* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 768px) {
      header { padding: 0 1rem; }
      .logo-tagline { display: none; }
      .nav-link { display: none; }
      section { padding: 3rem 1rem; }
      .qs-grid { grid-template-columns: 1fr; }
      .diagrams-grid { grid-template-columns: 1fr; }
      .hero { padding: 4rem 1rem 3rem; }
      .code-panel-inner { grid-template-columns: 1fr; }
      .neural-grid { grid-template-columns: 3fr; }
    }
  </style>
</head>
<body>

<!-- â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header>
  <a href="#" class="logo">
    <div class="logo-mark">M</div>
    <div class="logo-info">
      <span class="logo-name">Momoto</span>
      <span class="logo-tagline">Momoto decides. Momoto UI renders.</span>
    </div>
  </a>
  <nav>
    <a href="#how-it-works" class="nav-link">Pipeline</a>
    <a href="#architecture" class="nav-link">Rustâ†’WASM</a>
    <a href="#api" class="nav-link">API</a>
    <a href="#quickstart" class="nav-link">Quickstart</a>
    <a href="https://github.com/zuclubit/momoto-ui" class="nav-link" target="_blank">GitHub â†—</a>
    <a href="momoto.json" class="nav-cta">JSON Spec</a>
  </nav>
</header>

<!-- â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="hero">
  <div class="hero-eyebrow">Rust â†’ WebAssembly &nbsp;Â·&nbsp; v7.0.0 &nbsp;Â·&nbsp; MIT License</div>
  <h1>Chromatic Intelligence<br/>for the Web</h1>
  <p class="hero-sub">Perceptual color science, WCAG/APCA accessibility metrics, glass physics, and AI color recommendations â€” compiled to a single WASM module.</p>
  <p class="hero-tagline"><strong>Momoto decides.</strong> &nbsp;Momoto UI renders.</p>
  <div class="hero-actions">
    <a href="#quickstart" class="btn btn-primary">âš¡ Quickstart</a>
    <a href="#api" class="btn btn-ghost">ðŸ“– API Reference</a>
    <a href="https://github.com/zuclubit/momoto-ui" class="btn btn-ghost" target="_blank">â˜… GitHub</a>
  </div>
  <div class="hero-stats">
    <div class="stat"><div class="stat-n">9</div><div class="stat-l">WASM Modules</div></div>
    <div class="stat"><div class="stat-n">230+</div><div class="stat-l">API Items</div></div>
    <div class="stat"><div class="stat-n">100+</div><div class="stat-l">WASM Classes</div></div>
    <div class="stat"><div class="stat-n">483</div><div class="stat-l">SIREN Params</div></div>
    <div class="stat"><div class="stat-n">12</div><div class="stat-l">Metal Presets</div></div>
    <div class="stat"><div class="stat-n">4</div><div class="stat-l">Sprints Complete</div></div>
  </div>
</div>

<div class="divider"></div>

<!-- â”€â”€ HOW MOMOTO WORKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section id="how-it-works">
  <p class="section-label">Live Pipeline</p>
  <h2>How <span>Momoto</span> Works</h2>
  <p class="section-desc">Trace a brand color through Momoto's full perceptual pipeline: from raw hex input through physics-accurate color science, accessibility validation, SIREN neural correction, and final tonal palette generation.</p>

  <div class="pipeline" id="pipeline">

    <!-- STEP 1 -->
    <div class="pipeline-step active" id="ps1">
      <div class="pipeline-step-header" onclick="toggleStep('ps1')">
        <span class="step-num">1</span>
        <span class="step-label">Color Input â€” parse &amp; decode</span>
        <span class="step-tag">Color.fromHex Â· sRGB decode</span>
        <span class="step-arrow">â€º</span>
      </div>
      <div class="pipeline-body">
        <div class="swatch-row">
          <div class="swatch" style="background:#5577cc"></div>
          <div class="swatch-info">
            <div class="swatch-hex">#5577cc</div>
            <div class="swatch-sub">sRGB &nbsp; r=85 &nbsp; g=119 &nbsp; b=204</div>
            <div class="swatch-sub">Linear &nbsp; R=0.1007 &nbsp; G=0.2122 &nbsp; B=0.6038</div>
          </div>
        </div>
        <div class="code-block" style="margin-top:.5rem">
          <pre style="white-space:pre-wrap">import init, { Color } from 'momoto-wasm';
await init();
const fg = Color.fromHex('#5577cc');
// â†’ r:85  g:119  b:204  alpha:1.0</pre>
        </div>
      </div>
    </div>

    <div class="flow-arrow">â†“ &nbsp; color space transforms</div>

    <!-- STEP 2 -->
    <div class="pipeline-step" id="ps2">
      <div class="pipeline-step-header" onclick="toggleStep('ps2')">
        <span class="step-num">2</span>
        <span class="step-label">Color Space Conversion â€” OKLCH Â· OKLab Â· HCT</span>
        <span class="step-tag">hexToHct Â· oklchToHct Â· OKLab.fromColor</span>
        <span class="step-arrow">â€º</span>
      </div>
      <div class="pipeline-body">
        <div class="cs-grid">
          <div class="cs-card">
            <div class="cs-name">OKLCH â€” Perceptual Polar</div>
            <div class="cs-vals">
              L <b>0.537</b> &nbsp; C <b>0.165</b> &nbsp; H <b>265Â°</b><br/>
              <span style="font-size:11px;color:var(--m-text-3)">Lâˆˆ[0,1] Â· Câ‰¥0 Â· Hâˆˆ[0,360)</span>
            </div>
          </div>
          <div class="cs-card">
            <div class="cs-name">OKLab â€” Perceptual Cartesian</div>
            <div class="cs-vals">
              L <b>0.537</b> &nbsp; a <b>-0.019</b> &nbsp; b <b>-0.164</b><br/>
              <span style="font-size:11px;color:var(--m-text-3)">uniform for interpolation</span>
            </div>
          </div>
          <div class="cs-card">
            <div class="cs-name">HCT â€” CAM16 + CIELAB</div>
            <div class="cs-vals">
              H <b>263.8Â°</b> &nbsp; C <b>37.4</b> &nbsp; T <b>44.1</b><br/>
              <span style="font-size:11px;color:var(--m-text-3)">Material Design 3 model</span>
            </div>
          </div>
        </div>
        <div class="code-block">
          <pre style="white-space:pre-wrap">const [hue, chroma, tone] = hexToHct('#5577cc');
// hue=263.8  chroma=37.4  tone=44.1

const oklch = new OKLCH(0.537, 0.165, 265);
const lab   = OKLab.fromColor(fg);
// L=0.537  a=-0.019  b=-0.164</pre>
        </div>
      </div>
    </div>

    <div class="flow-arrow">â†“ &nbsp; WCAG 2.1 + APCA-W3 v0.1.9</div>

    <!-- STEP 3 -->
    <div class="pipeline-step" id="ps3">
      <div class="pipeline-step-header" onclick="toggleStep('ps3')">
        <span class="step-num">3</span>
        <span class="step-label">Accessibility Analysis â€” WCAG &amp; APCA metrics</span>
        <span class="step-tag">wcagContrastRatio Â· APCAMetric Â· wcagPasses</span>
        <span class="step-arrow">â€º</span>
      </div>
      <div class="pipeline-body">
        <p style="font-size:12px;color:var(--m-text-3);margin-bottom:1rem">Foreground <b style="color:var(--m-text)">#5577cc</b> on background <b style="color:var(--m-text)">#07070e</b></p>
        <div class="metric-row">
          <div class="metric-header">
            <span class="metric-name">WCAG 2.1 Contrast Ratio</span>
            <span class="metric-val" style="color:var(--m-amber)">4.21 : 1 &nbsp;<span class="badge badge-fail">âœ— AA</span></span>
          </div>
          <div class="metric-bar-wrap"><div class="metric-bar bar-warn" style="width:40%"></div></div>
          <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--m-text-3);margin-top:3px"><span>1:1</span><span>AA 4.5</span><span>AAA 7.0</span><span>21:1</span></div>
        </div>
        <div class="metric-row">
          <div class="metric-header">
            <span class="metric-name">APCA-W3 v0.1.9 Lightness Contrast (Lc)</span>
            <span class="metric-val" style="color:var(--m-amber)">Lc 58.3 &nbsp;<span class="badge badge-fail">âœ— Body</span></span>
          </div>
          <div class="metric-bar-wrap"><div class="metric-bar bar-warn" style="width:55%"></div></div>
          <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--m-text-3);margin-top:3px"><span>0</span><span>heading 60</span><span>body 75</span><span>106</span></div>
        </div>
        <div class="code-block" style="margin-top:.75rem">
          <pre style="white-space:pre-wrap">const fg = Color.fromHex('#5577cc');
const bg = Color.fromHex('#07070e');
const ratio = wcagContrastRatio(fg, bg);   // 4.21
const passes = wcagPasses(ratio, 0, false); // false â€” AA needs 4.5

const apca = new APCAMetric();
const lc = apca.evaluate(fg, bg).value;    // 58.3 Lc (body needs â‰¥75)</pre>
        </div>
      </div>
    </div>

    <div class="flow-arrow">â†“ &nbsp; SIREN [9â†’16â†’16â†’3] Ï‰â‚€=30 Â· 483 params</div>

    <!-- STEP 4 -->
    <div class="pipeline-step" id="ps4">
      <div class="pipeline-step-header" onclick="toggleStep('ps4')">
        <span class="step-num">4</span>
        <span class="step-label">SIREN Neural Correction â€” perceptual delta computation</span>
        <span class="step-tag">computeSirenCorrection Â· applySirenCorrection</span>
        <span class="step-arrow">â€º</span>
      </div>
      <div class="pipeline-body">
        <p style="font-size:12px;color:var(--m-text-3);margin-bottom:.85rem">The SIREN network takes 9 inputs (bg OKLCH, fg OKLCH, APCA Lc, WCAG ratio, quality score) and outputs perceptual correction deltas clamped to safe ranges.</p>
        <div class="neural-grid">
          <div class="neural-card">
            <div class="neural-delta">+0.042</div>
            <div class="neural-label">Î”L &nbsp;âˆˆ [âˆ’0.15, +0.15]</div>
          </div>
          <div class="neural-card">
            <div class="neural-delta">+0.008</div>
            <div class="neural-label">Î”C &nbsp;âˆˆ [âˆ’0.05, +0.05]</div>
          </div>
          <div class="neural-card">
            <div class="neural-delta">âˆ’1.2Â°</div>
            <div class="neural-label">Î”H &nbsp;âˆˆ [âˆ’10Â°, +10Â°]</div>
          </div>
        </div>
        <div class="code-block">
          <pre style="white-space:pre-wrap">// bg OKLCH: L=0.04, C=0.02, H=270
// fg OKLCH: L=0.537, C=0.165, H=265
const corr = computeSirenCorrection(
  0.04, 0.02, 270,    // background
  0.537, 0.165, 265,  // foreground
  58.3, 4.21, 62.0    // APCA Lc, WCAG ratio, quality
);
// â†’ deltaL=+0.042  deltaC=+0.008  deltaH=-1.2Â°

const [L2, C2, H2] = applySirenCorrection(
  0.537, 0.165, 265,
  corr.deltaL, corr.deltaC, corr.deltaH
);
// â†’ L=0.579  C=0.173  H=263.8Â°</pre>
        </div>
      </div>
    </div>

    <div class="flow-arrow">â†“ &nbsp; gamut clamp â†’ validated output</div>

    <!-- STEP 5 -->
    <div class="pipeline-step" id="ps5">
      <div class="pipeline-step-header" onclick="toggleStep('ps5')">
        <span class="step-num">5</span>
        <span class="step-label">Validated Output â€” accessible pair + 13-tone MD3 palette</span>
        <span class="step-tag">hctTonalPalette Â· hctToHex Â· agentValidatePair</span>
        <span class="step-arrow">â€º</span>
      </div>
      <div class="pipeline-body">
        <div class="swatch-row" style="margin-bottom:1.25rem">
          <div class="swatch" style="background:oklch(0.579 0.173 264)"></div>
          <div class="swatch-info">
            <div class="swatch-hex">#6188d8 &nbsp; <span class="badge badge-pass">âœ“ AA &nbsp; 5.1:1</span></div>
            <div class="swatch-sub">OKLCH(0.579, 0.173, 264Â°) &nbsp;|&nbsp; HCT(264, 39, 47)</div>
            <div class="swatch-sub">APCA Lc = 76.4 &nbsp; <span style="color:var(--m-green)">âœ“ Body text</span></div>
          </div>
        </div>
        <p style="font-size:11px;color:var(--m-text-3);margin-bottom:.6rem">13-TONE HCT TONAL PALETTE &nbsp;(tones 0 â†’ 100)</p>
        <div class="tonal-row">
          <div><div class="tone-swatch" style="background:oklch(0 0 264)" title="Tone 0: #000000"></div><div class="tone-label">0</div></div>
          <div><div class="tone-swatch" style="background:oklch(0.13 0.05 264)" title="Tone 10"></div><div class="tone-label">10</div></div>
          <div><div class="tone-swatch" style="background:oklch(0.23 0.10 264)" title="Tone 20"></div><div class="tone-label">20</div></div>
          <div><div class="tone-swatch" style="background:oklch(0.33 0.15 264)" title="Tone 30"></div><div class="tone-label">30</div></div>
          <div><div class="tone-swatch" style="background:oklch(0.43 0.18 264)" title="Tone 40"></div><div class="tone-label">40</div></div>
          <div><div class="tone-swatch" style="background:oklch(0.537 0.165 264)" title="Tone 50 (original)"></div><div class="tone-label">50</div></div>
          <div><div class="tone-swatch" style="background:oklch(0.63 0.165 264)" title="Tone 60"></div><div class="tone-label">60</div></div>
          <div><div class="tone-swatch" style="background:oklch(0.73 0.14 264)" title="Tone 70"></div><div class="tone-label">70</div></div>
          <div><div class="tone-swatch" style="background:oklch(0.82 0.10 264)" title="Tone 80"></div><div class="tone-label">80</div></div>
          <div><div class="tone-swatch" style="background:oklch(0.90 0.05 264)" title="Tone 90"></div><div class="tone-label">90</div></div>
          <div><div class="tone-swatch" style="background:oklch(0.95 0.025 264)" title="Tone 95"></div><div class="tone-label">95</div></div>
          <div><div class="tone-swatch" style="background:oklch(0.99 0.005 264)" title="Tone 99"></div><div class="tone-label">99</div></div>
          <div><div class="tone-swatch" style="background:oklch(1.0 0 264)" title="Tone 100: #ffffff"></div><div class="tone-label">100</div></div>
        </div>
        <div class="code-block" style="margin-top:1rem">
          <pre style="white-space:pre-wrap">const [h, c] = hexToHct('#6188d8');          // h=264, c=39
const palette = hctTonalPalette(h, c);        // 39 values [H,C,T Ã— 13]
const tones   = [0,10,20,30,40,50,60,70,80,90,95,99,100];
tones.forEach((t,i) =>
  console.log(`Tone ${t}: ${hctToHex(palette[i*3], palette[i*3+1], palette[i*3+2])}`)
);

// Validate the corrected pair
const check = JSON.parse(agentValidatePair('#6188d8','#07070e','wcag','aa'));
// â†’ { passes: true, ratio: 5.1, level: "aa" }</pre>
        </div>
      </div>
    </div>

  </div><!-- /pipeline -->

  <!-- Reference diagrams -->
  <div style="margin-top:2.5rem">
    <p style="font-size:11px;text-transform:uppercase;letter-spacing:.1em;color:var(--m-text-3);margin-bottom:1rem">Reference diagrams</p>
    <div class="diagrams-grid">
      <div class="diagram-card" onclick="openModal('assets/momoto-ui-geno1.png','SIREN Neural Correction Flow')">
        <img src="assets/momoto-ui-geno1.png" alt="SIREN Neural Correction Flow" loading="lazy" />
        <div class="diagram-caption">
          <h3>SIREN Neural Correction Flow</h3>
          <p>9â†’16â†’16â†’3 network, 483 params, Ï‰â‚€=30. Corrects OKLCH pairs for perceptual quality.</p>
          <span class="diagram-tag">siren.rs</span>
        </div>
      </div>
      <div class="diagram-card" onclick="openModal('assets/momoto-ui-geno2.png','AI Visual Generator Pipeline')">
        <img src="assets/momoto-ui-geno2.png" alt="AI Visual Generator Pipeline" loading="lazy" />
        <div class="diagram-caption">
          <h3>AI Visual Generator Pipeline</h3>
          <p>4-phase agent pipeline: recommend â†’ configure materials â†’ render â†’ validate.</p>
          <span class="diagram-tag">agent.rs Â· materials_ext.rs</span>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="divider"></div>

<!-- â”€â”€ ARCHITECTURE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section id="architecture">
  <p class="section-label">End-to-End Pipeline</p>
  <h2>Rust â†’ WASM â†’ <span>TypeScript</span></h2>
  <p class="section-desc">Follow a real API call from the Rust implementation, through wasm-bindgen bindings, to TypeScript consumption. Pick a function to trace the full stack.</p>

  <div class="code-viewer">
    <div class="code-tabs">
      <button class="code-tab active" onclick="showCodePanel('hct-panel', this)">hexToHct &amp; Palette</button>
      <button class="code-tab" onclick="showCodePanel('siren-panel', this)">SIREN Neural Correction</button>
      <button class="code-tab" onclick="showCodePanel('brdf-panel', this)">Cook-Torrance BRDF</button>
      <button class="code-tab" onclick="showCodePanel('cvd-panel', this)">CVD Simulation</button>
    </div>

    <!-- HCT PANEL -->
    <div class="code-panel active" id="hct-panel">
      <div class="code-panel-inner">
        <div class="code-col">
          <div class="code-col-header"><span class="code-lang-badge lang-rust">Rust</span>momoto-wasm/src/hct.rs</div>
          <pre><span class="tk-at">#[wasm_bindgen(js_name = hexToHct)]</span>
<span class="tk-kw">pub fn</span> <span class="tk-fn">hex_to_hct</span>(hex: &amp;<span class="tk-ty">str</span>) -&gt; <span class="tk-ty">Float64Array</span> {
    <span class="tk-kw">let</span> color = <span class="tk-ty">Argb</span>::from_hex_str(hex)
        .expect(<span class="tk-st">"invalid hex"</span>);
    <span class="tk-kw">let</span> hct = <span class="tk-ty">Hct</span>::from_argb(color);
    <span class="tk-ty">Float64Array</span>::from(&amp;[
        hct.hue, hct.chroma, hct.tone
    ][..])
}

<span class="tk-at">#[wasm_bindgen(js_name = hctTonalPalette)]</span>
<span class="tk-kw">pub fn</span> <span class="tk-fn">hct_tonal_palette</span>(
    hue: <span class="tk-ty">f64</span>, chroma: <span class="tk-ty">f64</span>
) -&gt; <span class="tk-ty">Float64Array</span> {
    <span class="tk-cm">// 13 tones: 0,10,20,30,40,50,60,70,80,90,95,99,100</span>
    <span class="tk-kw">const</span> TONES: [<span class="tk-ty">f64</span>; <span class="tk-nm">13</span>] = [
        <span class="tk-nm">0.,10.,20.,30.,40.,50.,</span>
        <span class="tk-nm">60.,70.,80.,90.,95.,99.,100.</span>
    ];
    <span class="tk-kw">let mut</span> out = <span class="tk-ty">Vec</span>::with_capacity(<span class="tk-nm">39</span>);
    <span class="tk-kw">for</span> &amp;tone <span class="tk-kw">in</span> &amp;TONES {
        <span class="tk-kw">let</span> h = <span class="tk-ty">Hct</span>::from(hue, chroma, tone);
        out.extend_from_slice(&amp;[h.hue, h.chroma, h.tone]);
    }
    <span class="tk-ty">Float64Array</span>::from(out.as_slice())
}</pre>
        </div>
        <div class="code-col">
          <div class="code-col-header"><span class="code-lang-badge lang-wasm">WASM</span>pkg/momoto_wasm.js (generated)</div>
          <pre><span class="tk-cm">// wasm-bindgen auto-generated JS glue</span>
<span class="tk-kw">export function</span> <span class="tk-fn">hexToHct</span>(hex) {
    <span class="tk-kw">const</span> ptr = passStringToWasm0(hex, wasm.__wbindgen_malloc,
                                   wasm.__wbindgen_realloc);
    <span class="tk-kw">const</span> len = WASM_VECTOR_LEN;
    wasm.hex_to_hct(retptr, ptr, len);
    <span class="tk-kw">var</span> r0 = getInt32Memory0()[retptr / <span class="tk-nm">4</span> + <span class="tk-nm">0</span>];
    <span class="tk-kw">var</span> r1 = getInt32Memory0()[retptr / <span class="tk-nm">4</span> + <span class="tk-nm">1</span>];
    <span class="tk-kw">var</span> v1 = getArrayF64FromWasm0(r0, r1).slice();
    wasm.__wbindgen_free(r0, r1 * <span class="tk-nm">8</span>);
    <span class="tk-kw">return</span> v1; <span class="tk-cm">// Float64Array [hue, chroma, tone]</span>
}

<span class="tk-kw">export function</span> <span class="tk-fn">hctTonalPalette</span>(hue, chroma) {
    <span class="tk-cm">// same pattern â†’ Float64Array(39)</span>
    <span class="tk-cm">// [H0,C0,T0, H1,C1,T1, ... Ã— 13 tones]</span>
}</pre>
        </div>
        <div class="code-col">
          <div class="code-col-header"><span class="code-lang-badge lang-ts">TypeScript</span>Consumer</div>
          <pre><span class="tk-kw">import</span> init, {
    hexToHct, hctTonalPalette, hctToHex
} <span class="tk-kw">from</span> <span class="tk-st">'momoto-wasm'</span>;

<span class="tk-kw">await</span> init(); <span class="tk-cm">// load .wasm binary</span>

<span class="tk-cm">// 1. Convert hex â†’ HCT</span>
<span class="tk-kw">const</span> [hue, chroma, tone] =
    hexToHct(<span class="tk-st">'#5577cc'</span>);
<span class="tk-cm">// â†’ [263.8, 37.4, 44.1]</span>

<span class="tk-cm">// 2. Generate 13-tone palette</span>
<span class="tk-kw">const</span> pal = hctTonalPalette(hue, chroma);
<span class="tk-cm">// Float64Array(39) [H,C,T Ã— 13]</span>

<span class="tk-cm">// 3. Convert each tone to hex</span>
<span class="tk-kw">const</span> tones = [<span class="tk-nm">0,10,20,30,40,50,60,70,80,90,95,99,100</span>];
tones.forEach((t, i) =&gt; {
    <span class="tk-kw">const</span> hex = hctToHex(
        pal[i*<span class="tk-nm">3</span>], pal[i*<span class="tk-nm">3</span>+<span class="tk-nm">1</span>], pal[i*<span class="tk-nm">3</span>+<span class="tk-nm">2</span>]
    );
    console.log(<span class="tk-st">`Tone </span>${t}<span class="tk-st">: </span>${hex}<span class="tk-st">`</span>);
});</pre>
        </div>
      </div>
    </div>

    <!-- SIREN PANEL -->
    <div class="code-panel" id="siren-panel">
      <div class="code-panel-inner">
        <div class="code-col">
          <div class="code-col-header"><span class="code-lang-badge lang-rust">Rust</span>momoto-wasm/src/siren.rs</div>
          <pre><span class="tk-cm">// Architecture: [9 â†’ 16 â†’ 16 â†’ 3]</span>
<span class="tk-cm">// 483 params Â· Ï‰â‚€=30 Â· seed=421337</span>

<span class="tk-at">#[wasm_bindgen(js_name = computeSirenCorrection)]</span>
<span class="tk-kw">pub fn</span> <span class="tk-fn">compute_siren_correction</span>(
    bg_l: <span class="tk-ty">f64</span>, bg_c: <span class="tk-ty">f64</span>, bg_h: <span class="tk-ty">f64</span>,
    fg_l: <span class="tk-ty">f64</span>, fg_c: <span class="tk-ty">f64</span>, fg_h: <span class="tk-ty">f64</span>,
    apca_lc: <span class="tk-ty">f64</span>, wcag_ratio: <span class="tk-ty">f64</span>,
    quality: <span class="tk-ty">f64</span>,
) -&gt; <span class="tk-ty">SirenCorrection</span> {
    <span class="tk-kw">let</span> inp = normalize_input([
        bg_l, bg_c, bg_h/<span class="tk-nm">360.</span>,
        fg_l, fg_c, fg_h/<span class="tk-nm">360.</span>,
        apca_lc/<span class="tk-nm">100.</span>, wcag_ratio/<span class="tk-nm">21.</span>,
        quality/<span class="tk-nm">100.</span>,
    ]);
    <span class="tk-kw">let</span> h1 = <span class="tk-fn">siren_layer</span>(&amp;inp, &amp;W1, &amp;B1);
    <span class="tk-kw">let</span> h2 = <span class="tk-fn">siren_layer</span>(&amp;h1,  &amp;W2, &amp;B2);
    <span class="tk-kw">let</span> out = <span class="tk-fn">linear_layer</span>(&amp;h2, &amp;W3, &amp;B3);
    <span class="tk-ty">SirenCorrection</span> {
        delta_l: out[<span class="tk-nm">0</span>].clamp(<span class="tk-nm">-0.15</span>, <span class="tk-nm">0.15</span>),
        delta_c: out[<span class="tk-nm">1</span>].clamp(<span class="tk-nm">-0.05</span>, <span class="tk-nm">0.05</span>),
        delta_h: out[<span class="tk-nm">2</span>].clamp(<span class="tk-nm">-10.</span>, <span class="tk-nm">10.</span>),
    }
}</pre>
        </div>
        <div class="code-col">
          <div class="code-col-header"><span class="code-lang-badge lang-wasm">WASM</span>SirenCorrection class</div>
          <pre><span class="tk-cm">// Generated wrapper class</span>
<span class="tk-kw">export class</span> <span class="tk-ty">SirenCorrection</span> {
    <span class="tk-fn">free</span>() { <span class="tk-cm">/* drop WASM memory */</span> }

    <span class="tk-kw">get</span> <span class="tk-fn">deltaL</span>() {
        <span class="tk-kw">return</span> wasm
          .__wbg_get_sirencorrection_delta_l(
            <span class="tk-kw">this</span>.__wbg_ptr
          );
    }
    <span class="tk-kw">get</span> <span class="tk-fn">deltaC</span>() { <span class="tk-cm">/* same pattern */</span> }
    <span class="tk-kw">get</span> <span class="tk-fn">deltaH</span>() { <span class="tk-cm">/* same pattern */</span> }
}

<span class="tk-kw">export function</span> <span class="tk-fn">computeSirenCorrection</span>(
    bg_l, bg_c, bg_h,
    fg_l, fg_c, fg_h,
    apca_lc, wcag_ratio, quality
) {
    <span class="tk-kw">const</span> ret = wasm.compute_siren_correction(
        bg_l, bg_c, bg_h,
        fg_l, fg_c, fg_h,
        apca_lc, wcag_ratio, quality
    );
    <span class="tk-kw">return</span> <span class="tk-ty">SirenCorrection</span>.__wrap(ret);
}</pre>
        </div>
        <div class="code-col">
          <div class="code-col-header"><span class="code-lang-badge lang-ts">TypeScript</span>Consumer</div>
          <pre><span class="tk-kw">import</span> init, {
    computeSirenCorrection,
    applySirenCorrection,
    sirenMetadata,
} <span class="tk-kw">from</span> <span class="tk-st">'momoto-wasm'</span>;

<span class="tk-kw">await</span> init();

<span class="tk-cm">// Inspect network metadata</span>
<span class="tk-kw">const</span> meta = sirenMetadata();
<span class="tk-cm">// { arch:[9,16,16,3], totalParams:483,</span>
<span class="tk-cm">//   omega0:30, seed:421337 }</span>

<span class="tk-cm">// Run forward pass</span>
<span class="tk-kw">const</span> corr = computeSirenCorrection(
    <span class="tk-nm">0.04</span>, <span class="tk-nm">0.02</span>, <span class="tk-nm">270</span>,  <span class="tk-cm">// bg OKLCH</span>
    <span class="tk-nm">0.537</span>, <span class="tk-nm">0.165</span>, <span class="tk-nm">265</span>, <span class="tk-cm">// fg OKLCH</span>
    <span class="tk-nm">58.3</span>, <span class="tk-nm">4.21</span>, <span class="tk-nm">62.0</span>   <span class="tk-cm">// metrics</span>
);
console.log(corr.deltaL, corr.deltaC, corr.deltaH);
<span class="tk-cm">// +0.042  +0.008  -1.2</span>

<span class="tk-cm">// Apply to get corrected OKLCH</span>
<span class="tk-kw">const</span> [L, C, H] = applySirenCorrection(
    <span class="tk-nm">0.537</span>, <span class="tk-nm">0.165</span>, <span class="tk-nm">265</span>,
    corr.deltaL, corr.deltaC, corr.deltaH
);
<span class="tk-cm">// L=0.579  C=0.173  H=263.8</span></pre>
        </div>
      </div>
    </div>

    <!-- BRDF PANEL -->
    <div class="code-panel" id="brdf-panel">
      <div class="code-panel-inner">
        <div class="code-col">
          <div class="code-col-header"><span class="code-lang-badge lang-rust">Rust</span>momoto-wasm/src/materials_ext.rs</div>
          <pre><span class="tk-at">#[wasm_bindgen(js_name = cookTorranceBRDF)]</span>
<span class="tk-kw">pub fn</span> <span class="tk-fn">cook_torrance_brdf</span>(
    n_dot_v: <span class="tk-ty">f64</span>, n_dot_l: <span class="tk-ty">f64</span>,
    n_dot_h: <span class="tk-ty">f64</span>, h_dot_v: <span class="tk-ty">f64</span>,
    roughness: <span class="tk-ty">f64</span>, f0: <span class="tk-ty">f64</span>,
) -&gt; <span class="tk-ty">f64</span> {
    <span class="tk-cm">// GGX Normal Distribution Function</span>
    <span class="tk-kw">let</span> d = <span class="tk-fn">ggx_ndf</span>(n_dot_h, roughness);
    <span class="tk-cm">// Smith G2 masking-shadowing</span>
    <span class="tk-kw">let</span> g = <span class="tk-fn">smith_g2</span>(n_dot_v, n_dot_l, roughness);
    <span class="tk-cm">// Schlick Fresnel approximation</span>
    <span class="tk-kw">let</span> f = f0 + (<span class="tk-nm">1.0</span> - f0)
              * (<span class="tk-nm">1.0</span> - h_dot_v).powi(<span class="tk-nm">5</span>);
    <span class="tk-cm">// Cook-Torrance denominator: 4Â·NdotVÂ·NdotL</span>
    (d * g * f) /
    (<span class="tk-nm">4.0</span> * n_dot_v * n_dot_l + <span class="tk-nm">1e-7</span>)
}

<span class="tk-at">#[wasm_bindgen(js_name = orenNayarBRDF)]</span>
<span class="tk-kw">pub fn</span> <span class="tk-fn">oren_nayar_brdf</span>(
    n_dot_l: <span class="tk-ty">f64</span>, n_dot_v: <span class="tk-ty">f64</span>,
    l_dot_v: <span class="tk-ty">f64</span>, roughness: <span class="tk-ty">f64</span>,
) -&gt; <span class="tk-ty">f64</span> { <span class="tk-cm">/* Oren-Nayar 1994 */</span> }</pre>
        </div>
        <div class="code-col">
          <div class="code-col-header"><span class="code-lang-badge lang-wasm">WASM</span>PBR API â€” DielectricBSDF</div>
          <pre><span class="tk-cm">// High-level BSDF classes</span>
<span class="tk-kw">export class</span> <span class="tk-ty">DielectricBSDF</span> {
    <span class="tk-kw">static</span> <span class="tk-fn">glass</span>()       { <span class="tk-cm">/* ior=1.52 */</span> }
    <span class="tk-kw">static</span> <span class="tk-fn">water</span>()       { <span class="tk-cm">/* ior=1.33 */</span> }
    <span class="tk-kw">static</span> <span class="tk-fn">diamond</span>()     { <span class="tk-cm">/* ior=2.42 */</span> }
    <span class="tk-kw">static</span> <span class="tk-fn">frostedGlass</span>() { <span class="tk-cm">/* roughness=0.5 */</span> }

    evaluate(wi_x, wi_y, wi_z, wo_x, wo_y, wo_z) {
        <span class="tk-cm">// â†’ { reflectance, transmittance,</span>
        <span class="tk-cm">//     absorption, fresnel }</span>
    }
    validateEnergy() {
        <span class="tk-cm">// R+T+A must equal 1.0</span>
    }
}

<span class="tk-kw">export class</span> <span class="tk-ty">ConductorBSDF</span> {
    <span class="tk-kw">static</span> <span class="tk-fn">gold</span>()   { <span class="tk-cm">/* n=0.17 k=3.5  */</span> }
    <span class="tk-kw">static</span> <span class="tk-fn">silver</span>() { <span class="tk-cm">/* n=0.05 k=4.2  */</span> }
    <span class="tk-kw">static</span> <span class="tk-fn">copper</span>() { <span class="tk-cm">/* n=0.25 k=2.8  */</span> }
}</pre>
        </div>
        <div class="code-col">
          <div class="code-col-header"><span class="code-lang-badge lang-ts">TypeScript</span>Consumer</div>
          <pre><span class="tk-kw">import</span> init, {
    cookTorranceBRDF, orenNayarBRDF,
    DielectricBSDF, ConductorBSDF,
    evaluateDielectricBatch,
} <span class="tk-kw">from</span> <span class="tk-st">'momoto-wasm'</span>;

<span class="tk-kw">await</span> init();

<span class="tk-cm">// Low-level: direct BRDF evaluation</span>
<span class="tk-kw">const</span> spec = cookTorranceBRDF(
    <span class="tk-nm">0.9</span>,  <span class="tk-cm">// NdotV</span>
    <span class="tk-nm">0.85</span>, <span class="tk-cm">// NdotL</span>
    <span class="tk-nm">0.9</span>,  <span class="tk-cm">// NdotH</span>
    <span class="tk-nm">0.88</span>, <span class="tk-cm">// HdotV</span>
    <span class="tk-nm">0.2</span>,  <span class="tk-cm">// roughness (0=mirror, 1=rough)</span>
    <span class="tk-nm">0.04</span>  <span class="tk-cm">// F0 (glass = 0.04)</span>
);

<span class="tk-cm">// High-level: PBR preset</span>
<span class="tk-kw">const</span> glass = DielectricBSDF.glass();
<span class="tk-kw">const</span> result = glass.evaluate(
    <span class="tk-nm">0,0,1</span>,  <span class="tk-cm">// incident direction wi</span>
    <span class="tk-nm">0,0,1</span>   <span class="tk-cm">// outgoing direction wo</span>
);
<span class="tk-cm">// { reflectance:0.04, transmittance:0.96,</span>
<span class="tk-cm">//   absorption:0.0 }</span>

<span class="tk-cm">// Batch: evaluate 1000 materials at once</span>
<span class="tk-kw">const</span> iors = <span class="tk-kw">new</span> Float64Array([<span class="tk-nm">1.33,1.5,2.42</span>]);
<span class="tk-kw">const</span> roughs = <span class="tk-kw">new</span> Float64Array([<span class="tk-nm">0.1,0.2,0.05</span>]);
<span class="tk-kw">const</span> thetas = <span class="tk-kw">new</span> Float64Array([<span class="tk-nm">0.9,0.8,0.95</span>]);
<span class="tk-kw">const</span> batch = evaluateDielectricBatch(iors,roughs,thetas);
<span class="tk-cm">// Float64Array [R,T,A, R,T,A, R,T,A]</span></pre>
        </div>
      </div>
    </div>

    <!-- CVD PANEL -->
    <div class="code-panel" id="cvd-panel">
      <div class="code-panel-inner">
        <div class="code-col">
          <div class="code-col-header"><span class="code-lang-badge lang-rust">Rust</span>momoto-wasm/src/intelligence.rs</div>
          <pre><span class="tk-cm">// ViÃ©not 1999 â€” row-stochastic matrices</span>
<span class="tk-cm">// in linear sRGB. D65 white preserved.</span>

<span class="tk-at">#[wasm_bindgen(js_name = simulateCVD)]</span>
<span class="tk-kw">pub fn</span> <span class="tk-fn">simulate_cvd</span>(
    hex: &amp;<span class="tk-ty">str</span>,
    cvd_type: &amp;<span class="tk-ty">str</span>,
) -&gt; <span class="tk-ty">String</span> {
    <span class="tk-kw">let</span> rgb = <span class="tk-ty">LinearRgb</span>::from_hex(hex);
    <span class="tk-kw">let</span> mat = <span class="tk-kw">match</span> cvd_type {
        <span class="tk-st">"protanopia"</span>   =&gt; VIENOT_PROT,
        <span class="tk-st">"deuteranopia"</span> =&gt; VIENOT_DEUT,
        <span class="tk-st">"tritanopia"</span>   =&gt; VIENOT_TRIT,
        _ =&gt; <span class="tk-kw">return</span> hex.to_owned(),
    };
    <span class="tk-kw">let</span> sim = mat_mul_3x3(mat, rgb);
    <span class="tk-ty">LinearRgb</span>::from(sim).to_hex()
}

<span class="tk-cm">// cvdDeltaE: OKLab distance originalâ†”simulated</span>
<span class="tk-at">#[wasm_bindgen(js_name = cvdDeltaE)]</span>
<span class="tk-kw">pub fn</span> <span class="tk-fn">cvd_delta_e</span>(
    hex: &amp;<span class="tk-ty">str</span>, cvd_type: &amp;<span class="tk-ty">str</span>
) -&gt; <span class="tk-ty">f64</span> { <span class="tk-cm">/* &lt;20 mild Â· 20-60 mod Â· &gt;60 severe */</span> }</pre>
        </div>
        <div class="code-col">
          <div class="code-col-header"><span class="code-lang-badge lang-wasm">WASM</span>ViÃ©not matrices</div>
          <pre><span class="tk-cm">// D65-normalized matrices (ViÃ©not 1999)</span>
<span class="tk-cm">// Row-stochastic: each row sums to 1.0</span>
<span class="tk-cm">// â†’ D65 white [1,1,1] is preserved exactly</span>

<span class="tk-cm">// Protanopia (L-cone absent):</span>
<span class="tk-cm">// [[0.567, 0.433, 0.000],</span>
<span class="tk-cm">//  [0.558, 0.442, 0.000],</span>
<span class="tk-cm">//  [0.000, 0.242, 0.758]]</span>

<span class="tk-cm">// Deuteranopia (M-cone absent):</span>
<span class="tk-cm">// [[0.625, 0.375, 0.000],</span>
<span class="tk-cm">//  [0.700, 0.300, 0.000],</span>
<span class="tk-cm">//  [0.000, 0.300, 0.700]]</span>

<span class="tk-cm">// Note: NOT Brettel 1997 LMS matrices</span>
<span class="tk-cm">// (Brettel uses equal-energy white E,</span>
<span class="tk-cm">//  causing white-shift with D65 inputs)</span>

<span class="tk-kw">export function</span> <span class="tk-fn">simulateCVD</span>(hex, cvdType) { }
<span class="tk-kw">export function</span> <span class="tk-fn">cvdDeltaE</span>(hex, cvdType) { }
<span class="tk-kw">export function</span> <span class="tk-fn">simulateCVDOklch</span>(l,c,h,type) { }</pre>
        </div>
        <div class="code-col">
          <div class="code-col-header"><span class="code-lang-badge lang-ts">TypeScript</span>Consumer</div>
          <pre><span class="tk-kw">import</span> init, {
    simulateCVD, cvdDeltaE,
    simulateCVDOklch,
} <span class="tk-kw">from</span> <span class="tk-st">'momoto-wasm'</span>;

<span class="tk-kw">await</span> init();

<span class="tk-kw">const</span> original = <span class="tk-st">'#3a7bd5'</span>;

<span class="tk-cm">// Simulate all 3 CVD types</span>
<span class="tk-kw">const</span> cvdTypes = [
    <span class="tk-st">'protanopia'</span>,
    <span class="tk-st">'deuteranopia'</span>,
    <span class="tk-st">'tritanopia'</span>,
];
cvdTypes.forEach(type =&gt; {
    <span class="tk-kw">const</span> sim = simulateCVD(original, type);
    <span class="tk-kw">const</span> dE  = cvdDeltaE(original, type);
    <span class="tk-cm">// dE &lt; 20  â†’ mild impact</span>
    <span class="tk-cm">// dE 20-60 â†’ moderate</span>
    <span class="tk-cm">// dE &gt; 60  â†’ severe â€” redesign needed</span>
    console.log(type, sim, `Î”E=${dE.toFixed(1)}`);
});

<span class="tk-cm">// In OKLCH space (no conversion overhead)</span>
<span class="tk-kw">const</span> [L2,C2,H2] = simulateCVDOklch(
    <span class="tk-nm">0.56</span>, <span class="tk-nm">0.15</span>, <span class="tk-nm">258</span>, <span class="tk-st">'deuteranopia'</span>
);</pre>
        </div>
      </div>
    </div>
  </div><!-- /code-viewer -->

  <div style="margin-top:2rem">
    <div class="arch-box" id="arch-diagram"></div>
  </div>
</section>

<div class="divider"></div>

<!-- â”€â”€ MODULES OVERVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section id="modules">
  <p class="section-label">API Surface</p>
  <h2>Nine Specialized <span>Modules</span></h2>
  <p class="section-desc">Each module is independently importable. Mix what you need â€” use only color metrics, only materials, or the full stack.</p>
  <div class="modules-grid" id="modules-grid"></div>
</section>

<div class="divider"></div>

<!-- â”€â”€ QUICKSTART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section id="quickstart">
  <p class="section-label">Get Started</p>
  <h2><span>Quickstart</span> Examples</h2>
  <p class="section-desc">Production-ready code. Copy, run, ship.</p>

  <div class="install-box">
    <div>
      <div style="font-size:13px;color:var(--m-text-2);margin-bottom:6px">Install</div>
      <code>npm install momoto-wasm</code>
    </div>
    <div style="width:1px;background:var(--m-border);align-self:stretch"></div>
    <div>
      <div style="font-size:13px;color:var(--m-text-2);margin-bottom:6px">Local (monorepo)</div>
      <code>"momoto-wasm": "file:./momoto/crates/momoto-wasm/pkg"</code>
    </div>
    <div>
      <p class="install-note">âš ï¸ Always call <code style="background:none;padding:0;color:var(--m-accent)">await init()</code> before any WASM function.</p>
    </div>
  </div>

  <div class="qs-grid" id="qs-grid"></div>
</section>

<div class="divider"></div>

<!-- â”€â”€ API EXPLORER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section id="api">
  <p class="section-label">API Reference</p>
  <h2>Complete <span>Function Reference</span></h2>
  <div class="search-row">
    <div class="search-wrap">
      <span class="search-icon">âŒ•</span>
      <input type="text" id="search" placeholder="Search functions, classes, parametersâ€¦" oninput="onSearch(this.value)" />
    </div>
    <div class="filter-pills" id="filter-pills"></div>
  </div>
  <div class="api-grid" id="api-grid"></div>
</section>

<div class="divider"></div>

<!-- â”€â”€ PHYSICS CONSTANTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<section id="constants">
  <p class="section-label">Reference</p>
  <h2>Physics & Algorithm <span>Constants</span></h2>
  <div class="physics-grid">
    <div class="physics-card">
      <div class="physics-label">WCAG 2.1 Contrast</div>
      <div class="physics-vals">
        AA Normal: <span>4.5:1</span><br/>AA Large: <span>3.0:1</span><br/>AAA Normal: <span>7.0:1</span><br/>AAA Large: <span>4.5:1</span>
      </div>
    </div>
    <div class="physics-card">
      <div class="physics-label">APCA-W3 v0.1.9 (Lc)</div>
      <div class="physics-vals">
        Body text: <span>â‰¥75</span><br/>Heading: <span>â‰¥60</span><br/>Caption: <span>â‰¥90</span><br/>Max Lc: <span>106</span>
      </div>
    </div>
    <div class="physics-card">
      <div class="physics-label">SIREN Architecture</div>
      <div class="physics-vals">
        Layers: <span>[9,16,16,3]</span><br/>Params: <span>483</span><br/>Ï‰â‚€: <span>30.0</span><br/>Seed: <span>421337</span>
      </div>
    </div>
    <div class="physics-card">
      <div class="physics-label">Thin Film (nm)</div>
      <div class="physics-vals">
        Visible: <span>380â€“700nm</span><br/>Soap bubble: <span>100â€“800nm</span><br/>Water IOR: <span>1.33</span><br/>Glass IOR: <span>1.52</span>
      </div>
    </div>
    <div class="physics-card">
      <div class="physics-label">Metal IOR (n, k)</div>
      <div class="physics-vals">
        Gold: <span>0.17, 3.5</span><br/>Silver: <span>0.05, 4.2</span><br/>Copper: <span>0.25, 2.8</span><br/>Chrome: <span>3.17, 3.31</span>
      </div>
    </div>
    <div class="physics-card">
      <div class="physics-label">Color Spaces</div>
      <div class="physics-vals">
        OKLCH L: <span>[0, 1]</span><br/>OKLCH H: <span>[0, 360Â°)</span><br/>HCT Tone: <span>[0, 100]</span><br/>BSDF: <span>R+T+A = 1</span>
      </div>
    </div>
  </div>
</section>

<!-- â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<footer>
  <div class="footer-logo">
    <div class="logo-mark" style="width:38px;height:38px;font-size:18px">M</div>
    <div class="footer-tagline">Momoto Engine</div>
  </div>
  <div class="footer-links">
    <a href="https://github.com/zuclubit/momoto-ui" target="_blank">GitHub â†—</a>
    <a href="momoto.json">JSON Spec</a>
    <a href="llms.txt">llms.txt</a>
    <a href="#api">API Reference</a>
    <a href="#quickstart">Quickstart</a>
    <a href="#constants">Constants</a>
  </div>
  <p class="footer-copy">v7.0.0 Â· MIT License Â· Â© 2026 Zuclubit</p>
  <p class="footer-standards">WCAG 2.1 Â· APCA-W3 v0.1.9 Â· HCT/CAM16 Â· Cook-Torrance Â· Oren-Nayar Â· Thin-Film TM Â· ViÃ©not CVD Â· SIREN Â· Perlin fBm</p>
</footer>

<!-- â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-overlay" id="modal" onclick="closeModal()">
  <button class="modal-close" onclick="closeModal()">âœ•</button>
  <img class="modal-img" id="modal-img" src="" alt="" />
</div>

<script>
// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const MODULES = [
  { key:'hct',          icon:'â¬¡', name:'HCT Color Space',       desc:'Google Material Design 3 perceptual model. CAM16 hue + CIELAB tone. Guaranteed gamut-safe tonal palettes via binary search.', fns:11 },
  { key:'core',         icon:'â—ˆ', name:'Core & Luminance',       desc:'Color, OKLCH, OKLab, LinearRgba. WCAG 2.1 + APCA-W3 v0.1.9 metrics, gamma, batch luminance, math utilities.', fns:24 },
  { key:'intelligence', icon:'â—‰', name:'Intelligence',           desc:'AI recommendations, 7 harmony types, CVD simulation (ViÃ©not 1999), constraint solver, quality scoring.', fns:22 },
  { key:'materials',    icon:'â—¬', name:'Materials & Physics',    desc:'Cook-Torrance GGX, Oren-Nayar, Airy/transfer-matrix thin film, Cauchy/Sellmeier dispersion, complex IOR (12 metal presets), Mie scattering (9 particle presets), multilayer TMM, refraction, shadows, interpolation. Sprints 1â€“4 complete.', fns:120 },
  { key:'temporal',     icon:'â—·', name:'Temporal Materials',     desc:'Time-evolving physics: drying paint, soap bubbles, heated metals. TemporalMaterial, TemporalThinFilmMaterial, TemporalConductorMaterial + lower-level TemporalDielectric, TemporalThinFilm, TemporalConductor. All R+T+A=1.', fns:18 },
  { key:'procedural',   icon:'â¬¦', name:'Procedural Noise',       desc:'Perlin fBm (ProceduralNoise). Same seed â†’ same field every frame. IOR variation and roughness fields for material micro-textures.', fns:8 },
  { key:'siren',        icon:'â—Ž', name:'SIREN Neural Network',   desc:'9â†’16â†’16â†’3 network (483 params, Ï‰â‚€=30, seed=421337). Deterministic perceptual correction. Forward pass + batch inference + weight export.', fns:9 },
  { key:'events',       icon:'â—Œ', name:'Events & Streaming',     desc:'MomotoEventBus pub/sub + MomotoEventStream SSE-compatible consumer. 8 built-in categories, buffer, filtered subscriptions.', fns:22 },
  { key:'agent',        icon:'â—©', name:'Agent API',              desc:'High-level JSON interface: validate, recommend, improve, score, batch ops. ContractBuilder, color transitions, self-certification.', fns:16 },
];

const API_ITEMS = [
  // â”€â”€ HCT â”€â”€
  { mod:'hct', type:'fn', name:'hexToHct', sig:'hexToHct(hex)', desc:'Convert hex string to HCT [hue, chroma, tone]. CAM16 hue + CIELAB tone. Returns flat Float64Array.', returns:'Float64Array [H,C,T]', example:'const [h,c,t] = hexToHct("#3a7bd5");\n// hâ‰ˆ263.8  câ‰ˆ37.4  tâ‰ˆ44.1' },
  { mod:'hct', type:'fn', name:'hctToHex', sig:'hctToHex(hue,chroma,tone)', desc:'HCT components to hex string. Auto gamut-clamps.', returns:'string "#rrggbb"', example:'hctToHex(250, 40, 60) // "#3370cc"' },
  { mod:'hct', type:'fn', name:'hctTonalPalette', sig:'hctTonalPalette(hue,chroma)', desc:'Generate 13-tone MD3 palette at tones [0,10,20,30,40,50,60,70,80,90,95,99,100]. Returns 39 floats.', returns:'Float64Array (39 values: 13Ã—[H,C,T])', example:'const pal = hctTonalPalette(250, 40);\nfor(let i=0;i<13;i++) console.log(hctToHex(pal[i*3],pal[i*3+1],pal[i*3+2]));' },
  { mod:'hct', type:'fn', name:'hctMaxChroma', sig:'hctMaxChroma(hue,tone)', desc:'Maximum sRGB-gamut chroma for given hue+tone via binary search (50 iterations).', returns:'number', example:'const maxC = hctMaxChroma(250, 60); // ~48' },
  { mod:'hct', type:'fn', name:'hctToHex', sig:'hctToHex(hue,chroma,tone)', desc:'HCT triple to hex string. Auto gamut-clamps to sRGB via binary search.', returns:'string "#rrggbb"', example:'hctToHex(250, 40, 60) // "#3a75cc"' },
  { mod:'hct', type:'fn', name:'hctTonalPalette', sig:'hctTonalPalette(hue,chroma)', desc:'Generate MD3 13-tone palette at tones [0,10,20,30,40,50,60,70,80,90,95,99,100]. Returns 39 floats [H,C,T Ã— 13].', returns:'Float64Array(39)', example:'const pal = hctTonalPalette(264, 38);\nfor(let i=0;i<13;i++) console.log(hctToHex(pal[i*3],pal[i*3+1],pal[i*3+2]));' },
  { mod:'hct', type:'fn', name:'hctMaxChroma', sig:'hctMaxChroma(hue,tone)', desc:'Maximum sRGB-gamut-safe chroma for given hue+tone. Uses binary search (50 iterations). Essential before calling hctTonalPalette with custom chroma.', returns:'number', example:'const maxC = hctMaxChroma(264, 60); // ~48' },
  { mod:'hct', type:'fn', name:'hctToOklch', sig:'hctToOklch(hue,chroma,tone)', desc:'Convert HCT â†’ OKLCH perceptual polar. Useful for crossing between MD3 and OKLCH pipelines.', returns:'Float64Array [L,C,H]' },
  { mod:'hct', type:'fn', name:'oklchToHct', sig:'oklchToHct(l,c,h)', desc:'Convert OKLCH â†’ HCT. Useful when you need MD3 tone from OKLCH input.', returns:'Float64Array [H,C,T]' },
  { mod:'hct', type:'class', name:'HCT', sig:'new HCT(hue,chroma,tone)', desc:'HCT color object. Methods: fromHex(hex), fromArgb(u32), toHex(), toArgb(), toOklch(), withTone(f64), withChroma(f64), withHue(f64), clampToGamut().', example:'const c = HCT.fromHex("#5577cc");\nconst darker = c.withTone(30).toHex();\nconst clamped = c.withChroma(200).clampToGamut();' },
  // â”€â”€ CORE â”€â”€
  { mod:'core', type:'class', name:'Color', sig:'new Color(r,g,b)', desc:'sRGB color [0â€“255]. Constructors: Color.fromHex(hex). Methods: toHex(), r(), g(), b(), alpha(), withAlpha(f64), lighten(amt), darken(amt), saturate(amt), desaturate(amt).', example:'const c = Color.fromHex("#5577cc");\nconsole.log(c.r(), c.g(), c.b()); // 85 119 204\nconst lighter = c.lighten(0.1).toHex();' },
  { mod:'core', type:'class', name:'OKLCH', sig:'new OKLCH(l,c,h)', desc:'Perceptual polar color. Methods: fromColor(Color), toColor(), l(), c(), h(), lighten(Î´), darken(Î´), saturate(f), desaturate(f), rotateHue(Â°), mapToGamut(), deltaE(other). Static: interpolate(a,b,t,huePath).', example:'const ok = new OKLCH(0.6, 0.18, 265);\nconst lighter = ok.lighten(0.1);\nconst mid = OKLCH.interpolate(ok, other, 0.5, "shorter");' },
  { mod:'core', type:'class', name:'OKLab', sig:'new OKLab(l,a,b)', desc:'Perceptual Cartesian space. Methods: fromColor(Color), toColor(), toOklch(), l(), a(), b(), deltaE(other). Static: interpolate(from,to,t).', example:'const lab = OKLab.fromColor(Color.fromHex("#5577cc"));\nconst diff = lab.deltaE(other); // ~0.1 = barely noticeable' },
  { mod:'core', type:'class', name:'LinearRgba', sig:'new LinearRgba(r,g,b,a)', desc:'Linear-light RGBA [0,1]. Methods: fromOklch(oklch, alpha), rgb(r,g,b) (static), r(), g(), b(), alpha(). Used for precise physics calculations.', example:'const lin = LinearRgba.fromOklch(new OKLCH(0.6,0.18,265), 1.0);' },
  { mod:'core', type:'class', name:'WCAGMetric', sig:'new WCAGMetric()', desc:'WCAG 2.1 contrast evaluator. Methods: evaluate(fg,bg)â†’ContrastResult, evaluateBatch(fgs,bgs). Static: passes(ratio,level,isLarge).', example:'const wm = new WCAGMetric();\nconst r = wm.evaluate(Color.fromHex("#000"), Color.fromHex("#fff"));\nconsole.log(r.value); // 21.0' },
  { mod:'core', type:'class', name:'APCAMetric', sig:'new APCAMetric()', desc:'APCA-W3 v0.1.9 contrast evaluator. Lc range: approximately âˆ’108 to +106. Methods: evaluate(fg,bg)â†’ContrastResult, evaluateBatch(fgs,bgs).', standard:'APCA-W3 v0.1.9', example:'const am = new APCAMetric();\nconst lc = am.evaluate(fg, bg).value; // e.g. 75.3' },
  { mod:'core', type:'class', name:'QualityScorer', sig:'new QualityScorer()', desc:'Multi-dimensional color pair quality score. Methods: score(fg,bg,context)â†’QualityScore. Score has: overall, compliance, perceptual, appropriateness, passes(), assessment(), confidence(), explanation().', example:'const ctx = RecommendationContext.bodyText();\nconst s = new QualityScorer().score(fg,bg,ctx);\nconsole.log(s.assessment()); // "Good"' },
  { mod:'core', type:'class', name:'CssRenderConfig', sig:'new CssRenderConfig()', desc:'Configuration for CSS glass rendering. Presets: minimal(), premium(), modal(), subtle(), darkMode(). Chainable: withSpecularIntensity(f), withFresnelIntensity(f), withElevation(u8), withBorderRadius(f), withLightMode(bool), withEffectsEnabled(bool).', example:'const cfg = CssRenderConfig.premium().withElevation(3);\nconst css = renderEnhancedCss(material, cfg);' },
  { mod:'core', type:'fn', name:'wcagContrastRatio', sig:'wcagContrastRatio(fg,bg)', desc:'WCAG contrast ratio = (L_lighter+0.05)/(L_darker+0.05). Range [1, 21].', returns:'number [1,21]', standard:'WCAG 2.1 Â§1.4.3', example:'const ratio = wcagContrastRatio(Color.fromHex("#000"), Color.fromHex("#fff"));\n// 21.0' },
  { mod:'core', type:'fn', name:'wcagPasses', sig:'wcagPasses(ratio,level,isLarge)', desc:'Check WCAG compliance. level: 0=AA (4.5:1 / 3:1 large), 1=AAA (7:1 / 4.5:1 large).', returns:'boolean', example:'wcagPasses(4.5, 0, false) // true â€” AA normal text\nwcagPasses(4.5, 1, false) // false â€” AAA needs 7:1' },
  { mod:'core', type:'fn', name:'relativeLuminanceSrgb', sig:'relativeLuminanceSrgb(color)', desc:'WCAG 2.1 relative luminance Yâˆˆ[0,1] per IEC 61966-2-1.', standard:'WCAG 2.1 / IEC 61966-2-1', example:'relativeLuminanceSrgb(Color.fromHex("#3a7bd5")) // 0.149' },
  { mod:'core', type:'fn', name:'relativeLuminanceBatch', sig:'relativeLuminanceBatch(rgbData)', desc:'Batch WCAG luminance. Input: Uint8Array [r,g,b, r,g,b, ...]. Length must be multiple of 3.', returns:'Float64Array', example:'const lums = relativeLuminanceBatch(new Uint8Array([255,0,0, 0,255,0]));\n// [0.2126, 0.7152]' },
  { mod:'core', type:'fn', name:'wcagContrastRatioBatch', sig:'wcagContrastRatioBatch(pairs)', desc:'Batch WCAG ratios. Input: Uint8Array [fg_r,fg_g,fg_b,bg_r,bg_g,bg_b,...]. Length must be multiple of 6.', returns:'Float64Array' },
  { mod:'core', type:'fn', name:'isLargeText', sig:'isLargeText(fontSizePx,fontWeight)', desc:'Check WCAG large-text: 18pt+ regular or 14pt+ bold (700+).', example:'isLargeText(24, 400) // true\nisLargeText(14, 700) // true (bold)' },
  { mod:'core', type:'fn', name:'apcaConstants', sig:'apcaConstants()', desc:'Get APCA-W3 v0.1.9 algorithm constants as JSON: mainTrc, sRco, sGco, sBco, blkThrs, blkClmp, normBg, normTxt, etc.', returns:'object', standard:'APCA-W3 v0.1.9' },
  { mod:'core', type:'fn', name:'srgbToLinear', sig:'srgbToLinear(value)', desc:'sRGB gamma decoding IEC 61966-2-1. Encoded [0,1] â†’ linear [0,1].', example:'srgbToLinear(0.5) // 0.2140' },
  { mod:'core', type:'fn', name:'linearToSrgb', sig:'linearToSrgb(value)', desc:'sRGB gamma encoding. Linear [0,1] â†’ gamma-encoded [0,1]. Inverse of srgbToLinear().', returns:'number [0,1]', example:'linearToSrgb(0.2140) // ~0.5' },
  { mod:'core', type:'fn', name:'relativeLuminanceApca', sig:'relativeLuminanceApca(color)', desc:'APCA-W3 v0.1.9 linearized luminance (different from WCAG â€” uses power curve with black clamping).', returns:'number [0,1]', standard:'APCA-W3 v0.1.9', example:'relativeLuminanceApca(Color.fromHex("#3a7bd5")) // 0.149 (similar but slightly different from WCAG)' },
  { mod:'core', type:'fn', name:'materialIsTransparent', sig:'materialIsTransparent(material)', desc:'Check if EvaluatedMaterial has high transmittance (transparent glass/water).', returns:'boolean' },
  { mod:'core', type:'fn', name:'materialHasScattering', sig:'materialHasScattering(material)', desc:'Check if EvaluatedMaterial has significant subsurface scattering.', returns:'boolean' },
  { mod:'core', type:'fn', name:'materialEffectiveSpecular', sig:'materialEffectiveSpecular(material)', desc:'Get effective specular intensity from EvaluatedMaterial (accounts for Fresnel + geometry).', returns:'number' },
  { mod:'core', type:'fn', name:'wcagLevel', sig:'wcagLevel(ratio,isLarge)', desc:'Return WCAG compliance level: 0=none, 1=AA, 2=AAA. Considers large-text threshold.', returns:'number 0|1|2', example:'wcagLevel(5.2, false) // 1 (AA)\nwcagLevel(7.5, false) // 2 (AAA)' },
  { mod:'core', type:'fn', name:'wcagRequirement', sig:'wcagRequirement(level,isLarge)', desc:'Minimum contrast ratio for level (0=AA, 1=AAA) and text size.', returns:'number', example:'wcagRequirement(0, false) // 4.5\nwcagRequirement(0, true)  // 3.0' },
  { mod:'core', type:'fn', name:'wcagRequirementsMatrix', sig:'wcagRequirementsMatrix()', desc:'Returns flat array [AA-normal, AA-large, AAA-normal, AAA-large] = [4.5, 3.0, 7.0, 4.5].', returns:'Float64Array(4)' },
  { mod:'core', type:'fn', name:'softClamp', sig:'softClamp(y,threshold,exponent)', desc:'Soft luminance clamping used in APCA calculations. Smooths near-black region.', returns:'number' },
  { mod:'core', type:'fn', name:'mathLerp', sig:'mathLerp(a,b,t)', desc:'Linear interpolation a + t*(b-a). Used internally in temporal and gradient systems.', returns:'number' },
  { mod:'core', type:'fn', name:'mathInverseLerp', sig:'mathInverseLerp(a,b,value)', desc:'Inverse lerp: returns t such that lerp(a,b,t)=value. Clamped to [0,1].', returns:'number' },
  { mod:'core', type:'fn', name:'apcaConstants', sig:'apcaConstants()', desc:'APCA-W3 v0.1.9 algorithm constants: mainTrc, sRco, sGco, sBco, blkThrs, blkClmp, normBg, normTxt, revBg, revTxt, revScale.', returns:'object', standard:'APCA-W3 v0.1.9' },
  { mod:'core', type:'fn', name:'relativeLuminanceBatch', sig:'relativeLuminanceBatch(rgbData)', desc:'Batch WCAG luminance. Uint8Array [r,g,b,...]. Length must be multiple of 3.', returns:'Float64Array', example:'const lums = relativeLuminanceBatch(new Uint8Array([255,0,0, 0,255,0]));\n// [0.2126, 0.7152]' },
  { mod:'core', type:'fn', name:'wcagContrastRatioBatch', sig:'wcagContrastRatioBatch(pairs)', desc:'Batch WCAG ratios. Uint8Array [fg_r,fg_g,fg_b,bg_r,bg_g,bg_b,...]. Length must be multiple of 6.', returns:'Float64Array' },
  // â”€â”€ INTELLIGENCE â”€â”€
  { mod:'intelligence', type:'class', name:'RecommendationEngine', sig:'new RecommendationEngine()', desc:'Color recommendation engine. Optimizes foreground for accessibility + perceptual quality.', example:'const engine = new RecommendationEngine();\nconst rec = engine.recommendForeground("#1a1a2e", "body_text", "wcag_aa");\nconsole.log(rec.hex, rec.score, rec.passes);' },
  { mod:'intelligence', type:'fn', name:'generatePalette', sig:'generatePalette(baseColor,harmonyType,count)', desc:'Generate harmonious palette. harmonyType: "complementary" | "triadic" | "analogous" | "split_complementary" | "tetradic" | "square" | "monochromatic".', returns:'string[]', example:'const triad = generatePalette("#3a7bd5", "triadic", 3);' },
  { mod:'intelligence', type:'fn', name:'generateShades', sig:'generateShades(color,count)', desc:'Generate perceptual shades (lightâ†’dark) in OKLCH. Typical count: 5â€“11.', example:'const shades = generateShades("#3a7bd5", 9);' },
  { mod:'intelligence', type:'fn', name:'simulateCVD', sig:'simulateCVD(hex,cvdType,severity)', desc:'Simulate color vision deficiency. ViÃ©not 1999 row-stochastic matrices in linear sRGB. D65 white preserved exactly.', params:{hex:'string',cvdType:'"protanopia"|"deuteranopia"|"tritanopia"',severity:'number [0,1]'}, note:'Uses ViÃ©not 1999, NOT Brettel 1997 (Brettel uses equal-energy white E â€” causes white-shift with D65).', returns:'string hex', example:'const sim = simulateCVD("#3a7bd5", "protanopia", 1.0);' },
  { mod:'intelligence', type:'fn', name:'harmonyScore', sig:'harmonyScore(lchFlat)', desc:'Score how harmonious a palette is [0,1]. Input: flat Float64Array [L,C,H,...] for 2+ colors.', returns:'number [0,1]', example:'const score = harmonyScore(generatePalette(0.6, 0.18, 265, 2, 3));\n// e.g. 0.82 = good harmony' },
  { mod:'intelligence', type:'fn', name:'temperaturePalette', sig:'temperaturePalette(warm)', desc:'Generate 5-color warm or cool temperature palette. warm=true â†’ ambers/reds. warm=false â†’ blues/cyans.', returns:'Float64Array [L,C,H Ã— 5]', example:'const warm = temperaturePalette(true);  // warm palette\nconst cool = temperaturePalette(false); // cool palette' },
  { mod:'intelligence', type:'fn', name:'generatePaletteFromHex', sig:'generatePaletteFromHex(hex,harmonyType)', desc:'Generate harmony palette from hex string. harmonyType: 0=Complementary, 1=SplitComplementary, 2=Triadic, 3=Tetradic, 4=Analogous, 5=Monochromatic.', returns:'Float64Array [L,C,H Ã— N]' },
  { mod:'intelligence', type:'fn', name:'cvdDeltaE', sig:'cvdDeltaE(hex,cvdType)', desc:'OKLab Î”E between original and CVD-simulated color. Severity: <20 mild, 20â€“60 moderate, >60 severe (redesign needed).', returns:'number', note:'Uses ViÃ©not 1999 (NOT Brettel 1997) â€” D65 white preserved exactly.', example:'const dE = cvdDeltaE("#3a7bd5", "protanopia");\n// dE > 60 â†’ severe impact for protanopes' },
  { mod:'intelligence', type:'fn', name:'simulateCVDOklch', sig:'simulateCVDOklch(l,c,h,cvdType)', desc:'CVD simulation directly in OKLCH space. Avoids hex conversion overhead for real-time use.', returns:'Float64Array [L,C,H]' },
  { mod:'intelligence', type:'fn', name:'oklchToHex', sig:'oklchToHex(l,c,h)', desc:'Convert OKLCH triple directly to hex string. Maps to sRGB with gamut clamping.', returns:'string "#rrggbb"' },
  { mod:'intelligence', type:'fn', name:'hexToOklch', sig:'hexToOklch(hex)', desc:'Convert hex string to OKLCH. Returns empty array on invalid input.', returns:'Float64Array [L,C,H] or []' },
  { mod:'intelligence', type:'fn', name:'scorePairsBatch', sig:'scorePairsBatch(pairs)', desc:'Batch quality scoring. Input: Float64Array multiples of 8 [fg_r,fg_g,fg_b, bg_r,bg_g,bg_b, usage, target, ...].', returns:'Float64Array | Error' },
  { mod:'intelligence', type:'fn', name:'recommendForegroundBatch', sig:'recommendForegroundBatch(backgrounds)', desc:'Batch foreground recommendations. Input: Uint8Array multiples of 5 [bg_r,bg_g,bg_b, usage, target, ...].', returns:'Array<Recommendation> | Error' },
  { mod:'intelligence', type:'class', name:'RecommendationEngine', sig:'new RecommendationEngine()', desc:'Color recommendation engine. Methods: recommendForeground(bg,usage,target)â†’Recommendation, improveForeground(fg,bg,usage,target)â†’Recommendation. Optimizes for contrast + perceptual quality simultaneously.', example:'const engine = new RecommendationEngine();\nconst rec = engine.recommendForeground(\n  Color.fromHex("#07070e"), 0, 0  // bg, BodyText, WCAG_AA\n);\nconsole.log(rec.hex(), rec.passes()); // "#c8d4ff" true' },
  { mod:'intelligence', type:'class', name:'ExplanationGenerator', sig:'new ExplanationGenerator()', desc:'Generate human-readable explanations for color recommendations. Methods: explainContrastImprovement(...), explainQualityImprovement(...). Returns RecommendationExplanation with toMarkdown(), summary(), benefits(), tradeOffs().', example:'const gen = new ExplanationGenerator();\nconst expl = gen.explainContrastImprovement(\n  "#5577cc","#6188d8","#07070e", 4.21, 5.1, 4.5,\n  0.042, 0.008, -1.2\n);\nconsole.log(expl.toMarkdown());' },
  { mod:'intelligence', type:'class', name:'AdvancedScorer', sig:'new AdvancedScorer()', desc:'Advanced scoring with impact/effort/priority analysis. scoreRecommendation(category, before*, after*, deltas) â†’ AdvancedScore with qualityOverall, impact, effort, confidence, priority, priorityAssessment(), isStrongRecommendation().', example:'const scorer = new AdvancedScorer();\nconst s = scorer.scoreRecommendation(\n  "contrast", 62, 0.7, 0.8, 0.6,\n  78, 0.85, 0.9, 0.7,\n  0.042, 0.008, -1.2\n);\nconsole.log(s.priorityAssessment()); // "High"' },
  { mod:'intelligence', type:'class', name:'ConvergenceDetector', sig:'new ConvergenceDetector()', desc:'Track optimization convergence over iterations. Presets: fast(), highQuality(), neural(). Methods: update(quality)â†’status, reset(), bestQuality(), iterationCount(), isProgressing(), stats().', example:'const det = ConvergenceDetector.highQuality();\nfor(let i=0; i<100; i++) {\n  const status = det.update(optimizeStep());\n  if(status.converged) break;\n}' },
  { mod:'intelligence', type:'fn', name:'solveColorConstraints', sig:'solveColorConstraints(lchFlat,constraintsJson,maxIterations)', desc:'Penalty-method constraint solver. Finds colors satisfying multiple simultaneous constraints. Constraints: MinContrast, MinAPCA, HarmonyAngle, InGamut, LightnessRange, ChromaRange.', returns:'{ colors:[L,C,H,...], converged, iterations, finalPenalty, violations }', note:'Pass initial colors as flat [L,C,H,...] and constraint JSON. See docs for schema.', example:'const r = solveColorConstraints(\n  new Float64Array([0.6, 0.18, 265,  0.1, 0.01, 270]),\n  JSON.stringify([\n    {"colorIdx":0,"kind":"MinContrast","otherIdx":1,"target":4.5},\n    {"colorIdx":0,"kind":"InGamut"}\n  ]), 200\n);\nconsole.log(r.converged, r.iterations);' },
  // â”€â”€ MATERIALS â”€â”€
  { mod:'materials', type:'fn', name:'cookTorranceBRDF', sig:'cookTorranceBRDF(normal,view,light,roughness,ior,cosTheta)', desc:'Cook-Torrance microfacet BRDF: GGX NDF + Smith G2 + Schlick Fresnel. Energy conserving.', standard:'Cook & Torrance 1982; GGX: Walter 2007; Smith G2: Heitz 2014', example:'const s = cookTorranceBRDF([0,1,0],[0,1,0],[0.7,0.7,0], 0.2, 1.5, 0.8);' },
  { mod:'materials', type:'fn', name:'orenNayarBRDF', sig:'orenNayarBRDF(roughness,normal,view,light)', desc:'Oren-Nayar diffuse BRDF. Generalizes Lambertian with inter-facet masking for rough surfaces.', standard:'Oren & Nayar 1994' },
  { mod:'materials', type:'fn', name:'thinFilmToRgb', sig:'thinFilmToRgb(thickness,ior,incidentAngle,illuminantType)', desc:'Thin-film interference color. Transfer-matrix method, 380â€“700nm spectrum, CIE 1931 CMFs.', params:{thickness:'nm (200â€“800 for visible)',ior:'film IOR',incidentAngle:'radians',illuminantType:'0=D65, 1=A, 2=F2'}, returns:'Float64Array [r,g,b]', example:'const [r,g,b] = thinFilmToRgb(350, 1.33, 0.0, 0); // soap bubble' },
  { mod:'materials', type:'fn', name:'gradientToCss', sig:'gradientToCss(env,curvature,shininess,samples,baseL,baseC,baseH)', desc:'Generate CSS linear-gradient string for glass surface rendering.', returns:'string CSS gradient' },
  { mod:'materials', type:'fn', name:'evaluateDielectricBatch', sig:'evaluateDielectricBatch(iors,roughnesses,cosThetas)', desc:'Batch dielectric BSDF. All arrays same length N. Returns flat [R,T,A Ã— N]. Energy conserving: R+T+A=1.', returns:'Float64Array [R,T,A Ã— N]', example:'const iors = new Float64Array([1.33, 1.52, 2.42]);\nconst roughnesses = new Float64Array([0.1, 0.2, 0.05]);\nconst thetas = new Float64Array([0.9, 0.8, 0.95]);\nconst r = evaluateDielectricBatch(iors, roughnesses, thetas);\n// [R0,T0,A0, R1,T1,A1, R2,T2,A2]' },
  { mod:'materials', type:'fn', name:'evaluateDielectricBSDF', sig:'evaluateDielectricBSDF(ior,roughness,cosTheta)', desc:'Single dielectric BSDF evaluation. Returns [reflectance, transmittance, absorption]. R+T+A=1 guaranteed.', returns:'Float64Array [R,T,A]' },
  { mod:'materials', type:'fn', name:'evaluateMicrofacetBSDF', sig:'evaluateMicrofacetBSDF(roughness,metallic,f0,cosTheta)', desc:'Unified microfacet model combining specular (Cook-Torrance) and diffuse (Oren-Nayar). metallic [0,1] interpolates between conductor and dielectric response.', returns:'Float64Array [R,T,A]' },
  { mod:'materials', type:'fn', name:'ggxNDF', sig:'ggxNDF(nDotH,roughness)', desc:'GGX Normal Distribution Function (Walter 2007). Returns probability density for microfacet orientation.', returns:'number', standard:'Walter et al. 2007' },
  { mod:'materials', type:'fn', name:'deltaE76', sig:'deltaE76(l1,a1,b1,l2,a2,b2)', desc:'CIE Î”E*76 color difference in CIELAB space. Simple Euclidean distance. Use deltaE2000 for perceptual accuracy.', returns:'number' },
  { mod:'materials', type:'fn', name:'deltaE2000', sig:'deltaE2000(l1,a1,b1,l2,a2,b2)', desc:'CIE Î”E 2000 â€” most perceptually accurate color difference metric. Accounts for lightness/chroma/hue weighting.', returns:'number', standard:'CIE 142:2001' },
  { mod:'materials', type:'fn', name:'deltaE2000Batch', sig:'deltaE2000Batch(labPairs)', desc:'Batch CIE Î”E 2000. Input: Float64Array multiples of 6 [L1,a1,b1,L2,a2,b2,...].', returns:'Float64Array | Error' },
  { mod:'materials', type:'fn', name:'rgbToLab', sig:'rgbToLab(r,g,b)', desc:'Convert sRGB [0,1] to CIELAB (D65 illuminant). Lâˆˆ[0,100], aâˆˆ[âˆ’128,127], bâˆˆ[âˆ’128,127].', returns:'Float64Array [L,a,b]' },
  { mod:'materials', type:'class', name:'DielectricBSDF', sig:'new DielectricBSDF(ior,roughness)', desc:'Physically-based dielectric material (glass, water, plastic). Presets: glass() ior=1.52, water() ior=1.33, diamond() ior=2.42, frostedGlass() roughness=0.5. Methods: evaluate(wi, wo)â†’{reflectance,transmittance,absorption,fresnel}, validateEnergy().', example:'const glass = DielectricBSDF.glass();\nconst r = glass.evaluate(0,0,1, 0,0,1);\n// { reflectance:0.04, transmittance:0.96, absorption:0 }' },
  { mod:'materials', type:'class', name:'ConductorBSDF', sig:'new ConductorBSDF(n,k,roughness)', desc:'Physically-based conductor (metals). Presets with real IOR: gold() n=0.17 k=3.5, silver() n=0.05 k=4.2, copper() n=0.25 k=2.8, aluminum(), chrome(). Methods: evaluate(wi,wo), validateEnergy().', example:'const gold = ConductorBSDF.gold();\nconst r = gold.evaluate(0,0,1, 0,0,1);\n// { reflectance:~0.98, transmittance:0, absorption:~0.02 }' },
  { mod:'materials', type:'class', name:'ThinFilmBSDF', sig:'new ThinFilmBSDF(substrateIor,filmIor,filmThickness)', desc:'Thin-film interference BSDF. Transfer matrix method over 380â€“700nm. Presets: soapBubble(thickness), oilOnWater(thickness), arCoating(). Methods: evaluate(wi,wo).', example:'const soap = ThinFilmBSDF.soapBubble(350);\n// iridescent at 350nm thickness' },
  { mod:'materials', type:'class', name:'LayeredBSDF', sig:'new LayeredBSDF()', desc:'Composable layered material. Chainable: pushDielectric(ior,roughness), pushConductor(n,k,roughness), pushThinFilm(subIor,filmIor,thickness), pushLambertian(albedo). Methods: layerCount(), evaluate(wi,wo), validateEnergy().', example:'const mat = new LayeredBSDF()\n  .pushThinFilm(1.0, 1.33, 400)\n  .pushDielectric(1.5, 0.1);\nconsole.log(mat.layerCount()); // 2' },
  { mod:'materials', type:'class', name:'PBRMaterial', sig:'PBRMaterial.fromPreset(preset)', desc:'High-level PBR material API. Presets: "glass","frostedGlass","water","diamond","gold","silver","copper","soapBubble","oilSlick". Methods: evaluate(), evaluateAtAngle(cosTheta). Static: builder()â†’PBRMaterialBuilder.', example:'const mat = PBRMaterial.fromPreset("gold");\nconst r = mat.evaluateAtAngle(0.8);\n// { reflectance, transmittance, absorption, roughness }' },
  { mod:'materials', type:'class', name:'LiquidGlass', sig:'new LiquidGlass(variant)', desc:'High-level glass surface. Variants: Regular, Clear. Methods: effectiveColor(bg)â†’Color, recommendTextColor(bg,preferWhite)â†’Color, getLayers(bg)â†’{highlight,base,shadow}, adaptForDarkMode(), adaptForLightMode().', example:'const glass = new LiquidGlass(GlassVariant.Regular);\nconst textColor = glass.recommendTextColor(bg, false);\nconst css = renderEnhancedCss(glass.evaluate(), CssRenderConfig.premium());' },
  { mod:'materials', type:'fn', name:'calculateAmbientShadow', sig:'calculateAmbientShadow(params,bgL,bgC,bgH,elevation)', desc:'Generate CSS box-shadow string for ambient shadow at elevation. Shadow adapts to background OKLCH color.', returns:'string CSS box-shadow', example:'const shadow = calculateAmbientShadow(\n  AmbientShadowParams.standard(), 0.1, 0.02, 270, 2.0\n);\n// "0 4px 12px rgba(...)"' },
  { mod:'materials', type:'fn', name:'calculateMultiScaleAmbient', sig:'calculateMultiScaleAmbient(params,bgL,bgC,bgH,elevation)', desc:'Multi-scale ambient shadow: combines close, mid, and far shadow layers. Returns comma-separated CSS box-shadow for more natural depth.', returns:'string CSS multi-shadow' },
  { mod:'materials', type:'fn', name:'renderEnhancedCss', sig:'renderEnhancedCss(material,context)', desc:'Generate complete CSS glass effect: background, backdrop-filter, border, box-shadow. Context: CssRenderConfig.', returns:'string CSS' },
  { mod:'materials', type:'fn', name:'getEnhancedGlassPresets', sig:'getEnhancedGlassPresets()', desc:'Get all built-in glass preset configurations as JSON array. Each preset includes name, ior, roughness, properties, CSS snippet.', returns:'object[]' },
  { mod:'materials', type:'fn', name:'getPresetsByQuality', sig:'getPresetsByQuality(tier)', desc:'Get presets filtered by quality tier: "fast" | "standard" | "high" | "ultraHigh" | "experimental" | "reference".', returns:'object[]' },
  { mod:'materials', type:'fn', name:'materialToDominantColor', sig:'materialToDominantColor(ior,roughness,cosTheta)', desc:'Extract dominant perceptual color from material physics. Returns [L,C,H, reflectance, colorTemp].', returns:'Float64Array [L,C,H,R,CCT]' },
  // â”€â”€ MATERIALS: Sprint 1 â€” Thin-Film Optics â”€â”€
  { mod:'materials', type:'class', name:'ThinFilm', sig:'new ThinFilm(nFilm,thicknessNm)', desc:'Thin-film interference via Airy formula (380â€“700nm). 12 presets: soapBubbleThin() ~100nm, soapBubbleMedium() ~200nm, soapBubbleThick() ~400nm, oilThin() ~150nm, oilMedium() ~300nm, oilThick() ~500nm, arCoating() MgFâ‚‚ Î»/4@550nm, oxideThin/Medium/Thick, beetleShell(), nacre(). Methods: reflectanceAt(Î»Nm,angleDeg), reflectanceRgb(angleDeg), colorHex(angleDeg), iridescenceMap(steps).', example:'const soap = ThinFilm.soapBubbleMedium();\nconst hex = soap.colorHex(0);          // e.g. "#e0b0ff"\nconst rgb = soap.reflectanceRgb(30.0); // [r,g,b] at 30Â°' },

  // â”€â”€ MATERIALS: Sprint 2 â€” Chromatic Dispersion & Metal IOR â”€â”€
  { mod:'materials', type:'class', name:'CauchyDispersion', sig:'new CauchyDispersion(a,b,c)', desc:'Cauchy chromatic dispersion n(Î»)=A+B/Î»Â²+C/Î»â´. 7 presets: crownGlass() BK7 Abbeâ‰ˆ64, flintGlass() SF11 Abbeâ‰ˆ25, fusedSilica() Abbeâ‰ˆ68, water() Abbeâ‰ˆ56, diamond() Abbeâ‰ˆ44, polycarbonate() Abbeâ‰ˆ30, pmma() Abbeâ‰ˆ57. Static factories: fromIor(ior), constant(ior). Methods: nAt(Î»Nm), abbeNumber(), dispersionRange(startNm,endNm).', example:'const bk7 = CauchyDispersion.crownGlass();\nconsole.log(bk7.nAt(550));     // 1.5168\nconsole.log(bk7.abbeNumber()); // ~64' },
  { mod:'materials', type:'class', name:'SellmeierDispersion', sig:'new SellmeierDispersion(coefficients)', desc:'Sellmeier dispersion nÂ²(Î»)âˆ’1=Î£ Báµ¢Î»Â²/(Î»Â²âˆ’Cáµ¢). Higher accuracy than Cauchy for UV/IR. 5 presets: bk7(), fk51a(), fusedSilica(), calcite(), sapphire(). Methods: nAt(Î»Nm), groupIndex(Î»Nm), groupVelocityDispersion(Î»Nm).', example:'const glass = SellmeierDispersion.bk7();\nconst n = glass.nAt(587.6); // 1.5168 (sodium D line)' },
  { mod:'materials', type:'class', name:'ComplexIOR', sig:'new ComplexIOR(n,k)', desc:'Complex refractive index nÌ‚=n+ik for metals. 12 presets with real-data IOR: gold() n=0.17 k=3.5, silver() n=0.05 k=4.2, copper() n=0.25 k=2.8, iron(), nickel(), platinum(), titanium(), chromium(), tungsten(), aluminum(), cobalt(), zinc(). Methods: reflectanceAt(cosTheta), absorptionAt(Î»Nm), skinDepthNm().', example:'const gold = ComplexIOR.gold();\nconst R = gold.reflectanceAt(1.0); // ~0.98\nconst Î´ = gold.skinDepthNm(532);   // ~11nm' },
  { mod:'materials', type:'class', name:'SpectralComplexIOR', sig:'new SpectralComplexIOR(wavelengths,ns,ks)', desc:'Wavelength-dependent complex IOR for spectral rendering. Presets: gold(), silver(), copper(). Methods: nAt(Î»Nm), kAt(Î»Nm), reflectanceRgb(cosTheta), colorHex(cosTheta).', example:'const gold = SpectralComplexIOR.gold();\nconst rgb = gold.reflectanceRgb(1.0); // characteristic golden hue\nconst hex = gold.colorHex(0.8);       // "#c8a050"' },
  { mod:'materials', type:'class', name:'DrudeParams', sig:'new DrudeParams(plasmaFreq,dampingFreq)', desc:'Drude free-electron metal model for temperature-dependent IOR. 7 presets: gold(), silver(), copper(), aluminum(), tungsten(), nickel(), platinum(). Methods: iorAt(Î»Nm)â†’{n,k}, temperatureDependentIor(Î»Nm,tempK)â†’{n,k}.', example:'const al = DrudeParams.aluminum();\nconst {n,k} = al.iorAt(550);                  // nâ‰ˆ0.15, kâ‰ˆ3.5\nconst hotAl = al.temperatureDependentIor(550, 900); // high-T IOR' },

  // â”€â”€ MATERIALS: Sprint 3 â€” Mie Scattering â”€â”€
  { mod:'materials', type:'class', name:'MieParams', sig:'new MieParams(radiusUm,nParticle,nMedium)', desc:'Mie scattering for spherical particles via size parameter x=2Ï€r/Î». 9 presets: fineDust() Rayleigh x~0.3, coarseDust(), fogSmall() 2Âµm, fogLarge() 10Âµm, cloud() 8Âµm, mist() 3Âµm, smoke() 0.3Âµm soot, milkGlobule() 2.5Âµm, pollen() 25Âµm geometric. Getters: radiusUm, nParticle, nMedium. Regimes: Rayleigh x<0.3 (blue sky), Mie x~1â€“10 (white clouds), Geometric x>30 (pollen).', example:'const fog = MieParams.fogSmall();\nconst scat = fog.scatteringCross(550); // scattering cross-section\nconst g = fog.asymmetryFactor();       // Henyey-Greenstein g' },
  { mod:'materials', type:'class', name:'DynamicMieParams', sig:'DynamicMieParams.evaporatingDroplet()', desc:'Time-varying Mie params for animated particle effects. 8 presets: evaporatingDroplet(), growingCrystal(), dissolvingSmoke(), coalescingFog(), swellingPollen(), shrinkingDust(), pulsatingBubble(), oscillatingAerosol(). Methods: paramsAtTime(t)â†’MieParams, scatteringColorAtTime(t,Î»Nm)â†’[r,g,b].', example:'const droplet = DynamicMieParams.evaporatingDroplet();\nconst [r,g,b] = droplet.scatteringColorAtTime(1.5, 550);\n// Color shifts from Mieâ†’Rayleigh as droplet shrinks' },

  // â”€â”€ MATERIALS: Sprint 4 â€” Multilayer Transfer Matrix â”€â”€
  { mod:'materials', type:'class', name:'FilmLayer', sig:'FilmLayer.dielectric(n,thicknessNm)', desc:'Single layer for TransferMatrixFilm stack. Constructors: dielectric(n,thicknessNm) for lossless layers; absorbing(n,k,thicknessNm) for metallic layers. Getters: n (real IOR), k (extinction), thicknessNm.', example:'const mgf2 = FilmLayer.dielectric(1.38, 99.6);    // Î»/4 MgFâ‚‚ at 550nm\nconst al   = FilmLayer.absorbing(0.15, 3.5, 50.0); // thin absorbing Al' },
  { mod:'materials', type:'class', name:'TransferMatrixFilm', sig:'new TransferMatrixFilm(nIncident,nSubstrate)', desc:'Transfer-matrix method for multilayer stacks: M=Dâ‚€â»Â¹Â·Î (Dáµ¢Â·Páµ¢Â·Dáµ¢â»Â¹)Â·Dâ‚›. Methods: addLayer(n,thicknessNm), addAbsorbingLayer(n,k,thicknessNm), reflectance(Î»Nm,angleDeg,pol)â†’[0,1], reflectanceRgb(angleDeg,pol)â†’[r,g,b], colorHex(angleDeg,pol), transmittanceSpectrum(pol). Static: braggMirror(nH,nL,Î»Nm,pairs) â€” quarter-wave mirror.', note:'Color emerges from STRUCTURE, not pigments. Polarization: 0=S, 1=P, 2=Average.', example:'// 5-pair Bragg mirror â€” >99% reflectance at design wavelength\nconst mirror = TransferMatrixFilm.braggMirror(2.35, 1.46, 550.0, 5);\nconst R = mirror.reflectance(550.0, 0.0, 2); // pol=Average\nconsole.log(`R=${(R*100).toFixed(1)}%`); // 99.x%\nconst rgb = mirror.reflectanceRgb(0.0, 2);  // structural green' },

  // â”€â”€ MATERIALS: Glass Surface â”€â”€
  { mod:'materials', type:'class', name:'GlassMaterial', sig:'new GlassMaterial(ior,roughness,tint,opacity)', desc:'Apple HIG-inspired glass surface. Presets: window() clear high-IOR, frosted() scattered, tinted(r,g,b,opacity). Methods: effectiveColor(bgL,bgC,bgH), luminanceCorrected(bgLum), withRoughness(r), withTint(r,g,b,a), withIor(ior), css(bgHex)â†’CSS string, cssDark(bgHex)â†’dark mode CSS.', example:'const win = GlassMaterial.window();\nconst css = win.css("#1a1a2e");\n// backdrop-filter: blur(20px); background: rgba(255,255,255,0.08); ...' },
  { mod:'materials', type:'class', name:'GlassMaterialBuilder', sig:'new GlassMaterialBuilder()', desc:'Fluent builder for custom GlassMaterial. Chainable: ior(n), roughness(r), tintRgba(r,g,b,a), opacity(a), frosted(), window(), tinted(hex). Terminal: build()â†’GlassMaterial.', example:'const mat = new GlassMaterialBuilder()\n  .ior(1.45)\n  .roughness(0.3)\n  .tintRgba(1.0, 1.0, 1.0, 0.15)\n  .build();\nconsole.log(mat.css("#07070e"));' },

  // â”€â”€ MATERIALS: Refraction System â”€â”€
  { mod:'materials', type:'class', name:'RefractionParams', sig:'new RefractionParams(index,distortionStrength,chromaticAberration,edgeLensing)', desc:'Refraction config for glass distortion effects. Presets: clear() minimal distortion, frosted() strong blur/distortion, thick() high index, subtle() light effect, highIndex() n>2.0. Property getters: index, distortionStrength, chromaticAberration, edgeLensing.', example:'const frosted = RefractionParams.frosted();\nconsole.log(frosted.distortionStrength); // 0.8\nconsole.log(frosted.chromaticAberration); // 0.12' },
  { mod:'materials', type:'fn', name:'calculateRefraction', sig:'calculateRefraction(params,x,y,incidentAngle)', desc:'Compute refraction offset at point (x,y) with incident angle. Returns [offset_x, offset_y, hue_shift, brightness_factor]. Use for per-pixel distortion.', returns:'Float64Array [offsetX,offsetY,hueShift,brightnessFactor]', example:'const par = RefractionParams.frosted();\nconst [ox,oy,hs,bf] = calculateRefraction(par, 0.5, 0.3, 0.1);\n// ox,oy: texel offset; hs: chromatic shift; bf: brightness scale' },
  { mod:'materials', type:'fn', name:'applyRefractionToColor', sig:'applyRefractionToColor(params,l,c,h,x,y,incidentAngle)', desc:'Apply refraction correction to OKLCH color at position (x,y). Returns shifted OKLCH triple.', returns:'Float64Array [L,C,H]', example:'const [L,C,H] = applyRefractionToColor(\n  RefractionParams.thick(), 0.5, 0.1, 260,\n  0.5, 0.3, 0.15 // x, y, incidentAngle\n);' },
  { mod:'materials', type:'fn', name:'generateDistortionMap', sig:'generateDistortionMap(params,gridSize)', desc:'Generate gridSizeÃ—gridSize distortion grid for GPU texture upload. Returns flat [offset_x,offset_y,hue_shift,brightness Ã— NÂ²]. Pass to WebGL as RGBA texture.', returns:'Float64Array [4 Ã— gridSizeÂ²]', example:'const map = generateDistortionMap(RefractionParams.frosted(), 64);\n// 64Ã—64 Ã— 4 = 16384 values â†’ texImage2D(gl.FLOAT)' },

  // â”€â”€ MATERIALS: Lighting System â”€â”€
  { mod:'materials', type:'class', name:'LightSource', sig:'new LightSource(x,y,z,l,c,h,intensity)', desc:'Directional light in OKLCH color space. Presets: defaultKeyLight() top-right 45Â° primary, defaultFillLight() softer left fill, dramaticTopLight() harsh overhead harsh. Used with LightingEnvironment and calculateLighting().', example:'const env = new LightingEnvironment();\nenv.addLight(LightSource.defaultKeyLight());\nenv.addLight(LightSource.defaultFillLight());\nconst lit = calculateLighting(env, 0.3, 0.1, 260);' },
  { mod:'materials', type:'class', name:'LightingEnvironment', sig:'new LightingEnvironment()', desc:'Multi-light environment for glass material evaluation. Methods: addLight(src)â†’void. Pass to calculateLighting().', example:'const env = new LightingEnvironment();\nenv.addLight(LightSource.dramaticTopLight());\nconst result = calculateLighting(env, 0.4, 0.12, 265);' },
  { mod:'materials', type:'fn', name:'calculateLighting', sig:'calculateLighting(env,l,c,h)', desc:'Evaluate multi-light environment on OKLCH surface color. Returns lighting result with specular, diffuse, ambient contributions.', returns:'object {specular,diffuse,ambient,resultL,resultC,resultH}', example:'const env = new LightingEnvironment();\nenv.addLight(LightSource.defaultKeyLight());\nconst lit = calculateLighting(env, 0.4, 0.12, 265);\n// { specular:0.32, diffuse:0.68, resultL:0.51, resultC:0.14, resultH:267 }' },
  { mod:'materials', type:'fn', name:'deriveGradient', sig:'deriveGradient(l,c,h,lightX,lightY,curvature)', desc:'Derive surface gradient from OKLCH color and light direction for glass highlight rendering. Returns [gradX, gradY, normalZ] normalized vector.', returns:'Float64Array [gradX,gradY,normalZ]' },

  // â”€â”€ MATERIALS: Shadow System â”€â”€
  { mod:'materials', type:'class', name:'AmbientShadowParams', sig:'new AmbientShadowParams(blurRadius,spread,opacity,color)', desc:'Elevation shadow config adapting to background color. 4 presets: standard() for cards, elevated() for modals/menus, subtle() for flat UI, dramatic() for popovers. Used with calculateAmbientShadow().', example:'const shadow = calculateAmbientShadow(\n  AmbientShadowParams.elevated(), 0.1, 0.02, 270, 3.0\n);\n// "0 8px 24px rgba(0,0,10, 0.45)"' },
  { mod:'materials', type:'class', name:'ElevationTransition', sig:'new ElevationTransition(rest,hover,active,focus)', desc:'Interactive elevation levels for UI components (Material Design 0â€“8 scale). Presets: card() rest=0 hover=2 active=1 focus=3, fab() rest=6 hover=8 active=7 focus=6, flat() rest=0 hover=1 active=0 focus=0. Used with calculateInteractiveShadow().', example:'const trans = ElevationTransition.card();\nconst shadow = calculateInteractiveShadow(\n  trans, 0.07, 0.01, 270, "hover"\n);\n// "0 4px 16px rgba(0,0,10, 0.35)"' },
  { mod:'materials', type:'fn', name:'calculateInteractiveShadow', sig:'calculateInteractiveShadow(transition,bgL,bgC,bgH,state)', desc:'Generate CSS box-shadow string based on interactive elevation state. state: "rest"|"hover"|"active"|"focus". Shadow color adapts to background OKLCH.', returns:'string CSS box-shadow', example:'const shadow = calculateInteractiveShadow(\n  ElevationTransition.fab(), 0.1, 0.02, 270, "hover"\n);\n// "0 8px 32px rgba(0,0,10, 0.55)"' },
  { mod:'materials', type:'fn', name:'elevationDp', sig:'elevationDp(level)', desc:'Material Design 3 elevation in density-independent pixels. 0â†’0dp, 1â†’1dp, 2â†’3dp, 3â†’6dp, 4â†’8dp, 5â†’12dp, 6â†’16dp, 7â†’24dp, 8â†’32dp.', returns:'number (dp)', example:'elevationDp(3) // 6\nelevationDp(6) // 16\nelevationDp(8) // 32' },
  { mod:'materials', type:'fn', name:'elevationTintOpacity', sig:'elevationTintOpacity(level)', desc:'Surface primary-color tint opacity at each elevation level per Material Design 3 spec.', returns:'number [0,1]', example:'elevationTintOpacity(3) // 0.08\nelevationTintOpacity(6) // 0.12\nelevationTintOpacity(8) // 0.15' },

  // â”€â”€ MATERIALS: Temporal Interpolation & Smoothing â”€â”€
  { mod:'materials', type:'class', name:'FlickerValidator', sig:'new FlickerValidator()', desc:'Spectral coherence validator preventing epileptic-risk flicker (HARDING compliance). Presets: strict() Harding standard, relaxed() for normal animations. Factory: withThresholds(stable,minor,warning). Methods: validate(prevLum,newLum,deltaTime)â†’status.', example:'const v = FlickerValidator.strict();\n// Ensure safe transitions:\nconst ok = v.validate(prevLum, newLum, 1/60);' },
  { mod:'materials', type:'class', name:'ConstraintValidator', sig:'new ConstraintValidator()', desc:'Physics constraint validator for BSDF energy conservation, reciprocity, and spectral monotonicity. Factory: withConfig(energyTolerance,reciprocityTolerance,maxSpectralGradient,hardClamp). Methods: validate(bsdf)â†’{valid,violations[],clampedValues}.', example:'const cv = ConstraintValidator.withConfig(0.001, 0.01, 0.3, true);\nconst result = cv.validate(myBsdf);' },
  { mod:'materials', type:'class', name:'RateLimiter', sig:'new RateLimiter(initial,maxRate,smooth)', desc:'Rate-limited value for smooth IOR/roughness animations. Methods: setTarget(v), update(time)â†’currentValue, reset(v,time). Getters: current, target, atTarget.', example:'const ior = new RateLimiter(1.33, 0.5, true);\nior.setTarget(1.52);\n// In animation loop:\nconst v = ior.update(performance.now() / 1000);\n// Smooth exponential approach' },
  { mod:'materials', type:'class', name:'ExponentialMovingAverage', sig:'new ExponentialMovingAverage(alpha)', desc:'EMA smoothing filter. alpha=1.0 = no smoothing; alpha=0.05 = heavy smoothing (Ï„â‰ˆ20 samples). Methods: update(value)â†’smoothed, reset(). Getter: value.', example:'const ema = new ExponentialMovingAverage(0.15);\nrequestAnimationFrame(function tick() {\n  const v = ema.update(rawMeasurement);\n  requestAnimationFrame(tick);\n});' },
  { mod:'materials', type:'fn', name:'applyInterpolation', sig:'applyInterpolation(mode,t)', desc:'Apply easing to tâˆˆ[0,1]. mode: 0=Linear, 1=Smoothstep (Hermite 3tÂ²âˆ’2tÂ³), 2=Smootherstep (Perlin 6tâµâˆ’15tâ´+10tÂ³), 3=EaseInOut, 4=Step.', returns:'number [0,1]', example:'applyInterpolation(1, 0.3)  // smoothstep  â†’ 0.216\napplyInterpolation(2, 0.3)  // smootherstep â†’ 0.163\napplyInterpolation(3, 0.25) // easeInOut   â†’ 0.125' },
  { mod:'materials', type:'fn', name:'interpolateValues', sig:'interpolateValues(mode,a,b,t)', desc:'Interpolate between a and b using easing mode. mode: 0=Linear, 1=Smoothstep, 2=Smootherstep, 3=EaseInOut, 4=Step.', returns:'number', example:'interpolateValues(1, 1.33, 1.52, 0.5) // ~1.425 (smoothstep)\ninterpolateValues(2, 380, 700, 0.5)   // ~540nm (smootherstep)' },
  { mod:'materials', type:'fn', name:'smoothstep', sig:'smoothstep(t)', desc:'Hermite cubic: 3tÂ²âˆ’2tÂ³. CÂ¹ continuous at 0 and 1. Standard for GPU shader transitions.', returns:'number [0,1]', example:'smoothstep(0.5)  // 0.5\nsmoothstep(0.25) // 0.15625\nsmoothstep(0.75) // 0.84375' },
  { mod:'materials', type:'fn', name:'smootherstep', sig:'smootherstep(t)', desc:'Perlin smootherstep: 6tâµâˆ’15tâ´+10tÂ³. CÂ² continuous â€” zero 1st and 2nd derivative at edges. Preferred for natural motion.', returns:'number [0,1]', example:'smootherstep(0.5)  // 0.5\nsmootherstep(0.25) // 0.103516\nsmootherstep(0.75) // 0.896484' },
  { mod:'materials', type:'fn', name:'easeInOut', sig:'easeInOut(t)', desc:'Symmetric quadratic ease: t<0.5 uses 2tÂ², tâ‰¥0.5 uses 1âˆ’(1âˆ’t)Â²Ã—2. Classic UI animation curve.', returns:'number [0,1]', example:'easeInOut(0.25) // 0.125 (slow start)\neaseInOut(0.5)  // 0.5\neaseInOut(0.75) // 0.875 (slow end)' },
  { mod:'materials', type:'fn', name:'remap', sig:'remap(value,inMin,inMax,outMin,outMax)', desc:'Remap value from [inMin,inMax] â†’ [outMin,outMax]. Essential for physicsâ†’CSS unit conversion.', returns:'number', example:'remap(0.8, 0.0, 1.0, 0.0, 20.0)  // 16.0 (roughnessâ†’blur px)\nremap(450, 380, 700, 0, 255)      // 43.5 (wavelengthâ†’pixel)' },

  // â”€â”€ MATERIALS: Batch & Rendering â”€â”€
  { mod:'materials', type:'class', name:'PBRMaterialBuilder', sig:'PBRMaterial.builder()', desc:'Fluent builder for PBRMaterial. Chainable: addDielectric(ior,roughness), addConductor(n,k,roughness), addThinFilm(filmIor,substrateIor,thicknessNm), color(r,g,b), opacity(a). Terminal: build()â†’PBRMaterial.', example:'const mat = PBRMaterial.builder()\n  .addDielectric(1.5, 0.05)\n  .addThinFilm(1.33, 1.0, 400)\n  .color(0.9, 0.9, 1.0)\n  .opacity(0.85)\n  .build();\nconst r = mat.evaluateAtAngle(0.8);' },
  { mod:'materials', type:'fn', name:'evaluateMaterialBatch', sig:'evaluateMaterialBatch(materials)', desc:'Batch evaluate materials. Input: Float64Array multiples of 3 [ior,roughness,metallic,...]. Returns [R,T,A Ã— N]. metallic=0 â†’ dielectric, metallic=1 â†’ conductor.', returns:'Float64Array [R,T,A Ã— N]', example:'const mats = new Float64Array([\n  1.5,  0.1, 0.0,  // glass\n  0.17, 0.0, 1.0,  // gold (complex IOR as n)\n  1.33, 0.3, 0.0   // frosted water\n]);\nconst r = evaluateMaterialBatch(mats);' },
  { mod:'materials', type:'fn', name:'deltaE94', sig:'deltaE94(l1,a1,b1,l2,a2,b2)', desc:'CIE Î”E 1994 color difference in CIELAB. Better than Î”E76 for industrial matching; use Î”E2000 for maximum perceptual accuracy.', returns:'number', standard:'CIE Î”E 1994' },
  { mod:'materials', type:'fn', name:'labToRgb', sig:'labToRgb(l,a,b)', desc:'Convert CIELAB (D65 illuminant) to sRGB [0,1]. Inverse of rgbToLab(). Result clamps to sRGB gamut.', returns:'Float64Array [r,g,b]', example:'const [r,g,b] = labToRgb(53.39, 0.0, 0.0); // neutral gray\nconst [r2,g2,b2] = labToRgb(32.30, 79.19, -107.86); // blue' },
  { mod:'materials', type:'fn', name:'renderPremiumCss', sig:'renderPremiumCss(material,context)', desc:'Generate premium-tier CSS glass: complete backdrop-filter, multi-layer gradient, dual-layer shadow, chromatic border glow. Superset of renderEnhancedCss.', returns:'string CSS', example:'const css = renderPremiumCss(\n  GlassMaterial.frosted(),\n  CssRenderConfig.premium().withElevation(4)\n);\n// backdrop-filter, gradient, border, multi-shadow' },

  // â”€â”€ TEMPORAL â”€â”€
  { mod:'temporal', type:'class', name:'TemporalMaterial', sig:'new TemporalMaterial(roughnessBase,roughnessTarget,roughnessTau,iorBase)', desc:'Time-evolving dielectric. Roughness evolves exponentially. Presets: .dryingPaint(), .weatheringGlass(). All BSDF evaluations guarantee R+T+A=1.0.', example:'const paint = TemporalMaterial.dryingPaint();\nconst [r,t,a] = paint.evalAtTime(30, 0.8); // halfway through drying' },
  { mod:'temporal', type:'class', name:'TemporalThinFilmMaterial', sig:'new TemporalThinFilmMaterial(thicknessBase,amplitude,frequencyHz,filmIor,substrateIor)', desc:'Oscillating thin-film â€” iridescent color shifts over time. Presets: .soapBubble(), .oilSlick().', example:'const bubble = TemporalThinFilmMaterial.soapBubble();\nconst tl = bubble.sampleTimeline(3.0, 180, 0.8); // 3s @ 60fps' },
  { mod:'temporal', type:'class', name:'TemporalConductorMaterial', sig:'new TemporalConductorMaterial(nBase,kBase,roughness,nTempCoeff,kTempCoeff)', desc:'Temperature-dependent conductor. Presets: .heatedGold(), .heatedCopper().', example:'const gold = TemporalConductorMaterial.heatedGold();\nconst [r,t,a] = gold.evalAtTemperature(800, 0.8); // glowing' },
  { mod:'temporal', type:'class', name:'TemporalDielectric', sig:'TemporalDielectric.dryingPaint()', desc:'Lightweight time-varying dielectric for physical aging. Presets: dryingPaint() roughness 0.8â†’0.05 Ï„=60s, weatheringGlass() IOR+roughness increase over hours. Lower-level than TemporalMaterial â€” no sampleTimeline(). Use with evaluateDielectricBatch().', example:'const paint = TemporalDielectric.dryingPaint();\n// Integrate with physics batch at time t=30s' },
  { mod:'temporal', type:'class', name:'TemporalThinFilm', sig:'TemporalThinFilm.soapBubble()', desc:'Lightweight time-evolving thin-film for animated iridescence. Preset: soapBubble() â€” thickness oscillates producing color shifts. For full animation API with sampleTimeline(), use TemporalThinFilmMaterial.soapBubble().', example:'const film = TemporalThinFilm.soapBubble();\n// Film thickness evolves: use with ThinFilm.reflectanceRgb() per frame' },
  { mod:'temporal', type:'class', name:'TemporalConductor', sig:'TemporalConductor.heatedGold()', desc:'Lightweight temperature-dependent conductor. Preset: heatedGold() â€” n,k shift with temperature. For evalAtTemperature() API, use TemporalConductorMaterial.heatedGold().', example:'const gold = TemporalConductor.heatedGold();\n// n,k coefficients shift as temperature rises' },
  // PROCEDURAL
  { mod:'procedural', type:'class', name:'ProceduralNoise', sig:'new ProceduralNoise(seed,octaves,persistence,lacunarity)', desc:'Improved Perlin fBm. Same seed â†’ same field. Presets: .frosted() 6oct, .regular() 3oct, .clear() 1oct, .thick() 4oct.', example:'const noise = ProceduralNoise.frosted();\nconst v = noise.sample(1.5, 2.3); // [0,1]' },
  { mod:'procedural', type:'fn', name:'variationField', sig:'variationField(baseIor,variation,cols,rows,seed)', desc:'2D IOR variation field for frosted-glass distortion maps.', returns:'Float64Array [baseIorÂ±variation]', example:'const iorMap = variationField(1.5, 0.05, 256, 256, 42);' },
  // SIREN
  { mod:'siren', type:'fn', name:'computeSirenCorrection', sig:'computeSirenCorrection(bgL,bgC,bgH,fgL,fgC,fgH,apcaLc,wcagRatio,quality)', desc:'SIREN forward pass: compute perceptual correction deltas for OKLCH pair. Inputs normalized internally.', returns:'SirenCorrection { deltaLâˆˆ[âˆ’0.15,0.15], deltaCâˆˆ[âˆ’0.05,0.05], deltaHâˆˆ[âˆ’10Â°,10Â°] }', example:'const corr = computeSirenCorrection(0.15,0.1,250, 0.9,0.02,250, 75,8.5,70);\nconst [L,C,H] = applySirenCorrection(0.9,0.02,250, corr.deltaL,corr.deltaC,corr.deltaH);' },
  { mod:'siren', type:'fn', name:'applySirenCorrection', sig:'applySirenCorrection(l,c,h,deltaL,deltaC,deltaH)', desc:'Apply SIREN correction deltas to OKLCH triple. Clamps result to valid ranges.', returns:'Float64Array [L,C,H]', example:'const [L,C,H] = applySirenCorrection(\n  0.537, 0.165, 265,\n  corr.deltaL, corr.deltaC, corr.deltaH\n);\n// L=0.579  C=0.173  H=263.8' },
  { mod:'siren', type:'fn', name:'computeSirenCorrectionBatch', sig:'computeSirenCorrectionBatch(inputs)', desc:'Batch SIREN inference. Input Float64Array multiples of 9 [bgL,bgC,bgH, fgL,fgC,fgH, apcaLc,wcagRatio,quality,...]. Returns flat [dL,dC,dH,...].', returns:'Float64Array', example:'const batch = computeSirenCorrectionBatch(new Float64Array([\n  0.04,0.02,270, 0.537,0.165,265, 58.3,4.21,62.0,\n  ...more\n]));' },
  { mod:'siren', type:'fn', name:'sirenMetadata', sig:'sirenMetadata()', desc:'Network metadata: architecture [9,16,16,3], totalParams=483, omega0=30, seed=421337, activations, inputNormalization, clampRanges.', returns:'object' },
  { mod:'siren', type:'fn', name:'sirenWeights', sig:'sirenWeights()', desc:'Export all network weights as JSON: W1(9Ã—16), B1(16), W2(16Ã—16), B2(16), W3(16Ã—3), B3(3). Useful for debugging or custom inference.', returns:'object { W1, B1, W2, B2, W3, B3 }' },
  // â”€â”€ EVENTS â”€â”€
  { mod:'events', type:'class', name:'MomotoEventBus', sig:'new MomotoEventBus()', desc:'Pub/sub event bus. Supports filtered subscriptions, buffer, max-age. Event categories (0â€“8+): Progress, Metrics, Recommendation, Validation, Error, System, Chart, Heartbeat, Custom. Static: withConfig(bufferSize,maxAgeMs).', example:'const bus = new MomotoEventBus();\nbus.subscribe(e => updateUI(e.category, e.payload));\nbus.emitProgress("engine", 50, "Analyzingâ€¦");\nconsole.log(bus.subscriberCount()); // 1\nconsole.log(bus.eventCount()); // 1' },
  { mod:'events', type:'class', name:'MomotoEventBus', sig:'new MomotoEventBus()', desc:'Pub/sub event bus. Methods: subscribe(cb)â†’id, subscribeFiltered(categories,cb)â†’id, emitProgress(src,pct,msg), emitMetric(src,name,val), emitError(src,desc), emitCustom(src,json), emitJson(json). Buffer: bufferedEvents(), clearBuffer(). Static: withConfig(bufferSize, maxAgeMs).', example:'const bus = new MomotoEventBus();\nbus.subscribe(e => console.log(e.category, e.payload));\nbus.emitProgress("engine", 50, "Computingâ€¦");\n// categories: 0=Progress,1=Metrics,2=Recommendation,3=Validation,4=Error,5=System' },
  { mod:'events', type:'class', name:'MomotoEventStream', sig:'MomotoEventStream.fromBus(bus)', desc:'SSE-compatible streaming consumer. Static constructors: fromBus(bus), fromBusBatched(bus,batchSize,timeoutMs), standalone(). Methods: poll()â†’{events,sequence,totalEvents,droppedEvents,count}|null, push(eventJson) [standalone mode], flush()â†’events, shouldFlush(), pendingCount(), totalEvents(), droppedEvents(), pause(), resume(), close(), stats(). Getter: state "Active"|"Paused"|"Closed".', example:'const stream = MomotoEventStream.fromBus(bus);\n// In animation loop:\nrequestAnimationFrame(function tick() {\n  const batch = stream.poll();\n  if(batch) batch.events.forEach(handleEvent);\n  requestAnimationFrame(tick);\n});\n// Standalone mode:\nconst s2 = MomotoEventStream.standalone();\ns2.push(JSON.stringify({category:0, payload:{}}));\nconst r = s2.poll();' },
  // â”€â”€ AGENT â”€â”€
  { mod:'agent', type:'fn', name:'agentValidatePair', sig:'agentValidatePair(fg,bg,standard,level)', desc:'Validate fg/bg contrast. standard: "wcag"|"apca", level: "aa"|"aaa".', returns:'JSON: { passes, ratio, level }', example:'const r = JSON.parse(agentValidatePair("#000","#fff","wcag","aa"));\n// { passes: true, ratio: 21.0, level: "aaa" }' },
  { mod:'agent', type:'fn', name:'agentGetMetrics', sig:'agentGetMetrics(color)', desc:'Comprehensive metrics: hex, oklch, hct, luminance.', returns:'JSON string', example:'const m = JSON.parse(agentGetMetrics("#3a7bd5"));\n// { hex, oklch, hct, luminance: 0.149 }' },
  { mod:'agent', type:'fn', name:'agentValidate', sig:'agentValidate(colorHex,contractJson)', desc:'Validate a color against a JSON contract (ContractBuilder output). Returns JSON: {passes, violations[], metrics}.', returns:'JSON string', example:'const contract = new ContractBuilder().minContrastWcagAa("#07070e").inSrgb().build();\nconst r = JSON.parse(agentValidate("#5577cc", contract));\nconsole.log(r.passes, r.violations);' },
  { mod:'agent', type:'fn', name:'agentValidatePairsBatch', sig:'agentValidatePairsBatch(pairsJson)', desc:'Batch validate multiple fg/bg pairs. Input: JSON array [{fg,bg,standard,level},...].', returns:'JSON string', example:'const pairs = [{fg:"#000",bg:"#fff",standard:0,level:0}, ...];\nconst results = JSON.parse(agentValidatePairsBatch(JSON.stringify(pairs)));' },
  { mod:'agent', type:'fn', name:'agentGetMetrics', sig:'agentGetMetrics(colorHex)', desc:'Complete color metrics: hex, oklch, hct, luminance (WCAG + APCA), gamut, temperature.', returns:'JSON string', example:'const m = JSON.parse(agentGetMetrics("#5577cc"));\n// { hex, oklch:{l,c,h}, hct:{hue,chroma,tone}, luminance:{wcag,apca} }' },
  { mod:'agent', type:'fn', name:'agentRecommendForeground', sig:'agentRecommendForeground(bgHex,context,target)', desc:'Recommend best foreground for a background. context: 0=BodyTextâ€¦5=Disabled, target: 0=WCAG_AAâ€¦3=Hybrid.', returns:'JSON string', example:'const r = JSON.parse(agentRecommendForeground("#07070e", 0, 0));\nconsole.log(r.hex, r.wcagRatio, r.passes);' },
  { mod:'agent', type:'fn', name:'agentImproveForeground', sig:'agentImproveForeground(fgHex,bgHex,context,target)', desc:'Improve an existing foreground to meet accessibility targets. Returns adjusted color with explanation.', returns:'JSON string', example:'const r = JSON.parse(agentImproveForeground("#5577cc","#07070e",0,0));\nconsole.log(r.original, r.improved, r.ratioImprovement);' },
  { mod:'agent', type:'fn', name:'agentScorePair', sig:'agentScorePair(fgHex,bgHex,context,target)', desc:'Score a color pair on overall quality, compliance, perceptual quality, and appropriateness.', returns:'JSON string', example:'const s = JSON.parse(agentScorePair("#6188d8","#07070e",0,0));\nconsole.log(s.overall, s.assessment); // 0.82 "Good"' },
  { mod:'agent', type:'fn', name:'createColorTransition', sig:'createColorTransition(fromHex,toHex,durationMs,easing,frameCount)', desc:'Generate color animation keyframes. Easing: "easeIn"|"easeOut"|"easeInOut"|"linear"|"step". Returns array of {t, hex, oklch}.', returns:'JSON string', example:'const frames = JSON.parse(createColorTransition(\n  "#5577cc","#ff6b6b", 500, "easeInOut", 60\n));\n// 60 keyframes for a smooth 500ms transition' },
  { mod:'agent', type:'fn', name:'generateExperience', sig:'generateExperience(preset,primaryHex,backgroundHex)', desc:'Generate complete visual experience config. Presets: "dashboard"|"landing"|"app". Returns CSS tokens, material params, color roles.', returns:'JSON string' },
  { mod:'agent', type:'fn', name:'getMomotoIdentity', sig:'getMomotoIdentity()', desc:'Engine identity: version 7.0.0, buildId, specVersion, phaseCoverage, major/minor/patch.', returns:'JSON string' },
  { mod:'agent', type:'fn', name:'selfCertify', sig:'selfCertify()', desc:'Run engine self-certification: validates WCAG golden vectors, APCA constants, SIREN weights checksum, HCT roundtrip accuracy.', returns:'JSON string { passed, tests[], timestamp }' },
  { mod:'agent', type:'fn', name:'agentGetMaterial', sig:'agentGetMaterial(preset)', desc:'Get material preset configuration by name. preset: "glass"|"frostedGlass"|"water"|"gold"|"silver"|"copper"|"soapBubble"|"oilSlick"|...', returns:'JSON string { name, ior, roughness, type, cssSnippet }', example:'const mat = JSON.parse(agentGetMaterial("frostedGlass"));\nconsole.log(mat.ior, mat.roughness); // 1.45, 0.5' },
  { mod:'agent', type:'fn', name:'agentListMaterials', sig:'agentListMaterials(category?)', desc:'List all available material presets, optionally filtered by category: "dielectric"|"conductor"|"thin_film"|"pbr".', returns:'JSON string (array of material descriptors)', example:'const all = JSON.parse(agentListMaterials());\nconst metals = JSON.parse(agentListMaterials("conductor"));\nconsole.log(metals.map(m => m.name));' },
  { mod:'agent', type:'fn', name:'agentGetMetricsBatch', sig:'agentGetMetricsBatch(colorsJson)', desc:'Get complete metrics for multiple colors in one WASM call. Input: JSON array of hex strings.', returns:'JSON string (array of metric objects)', example:'const metrics = JSON.parse(agentGetMetricsBatch(\n  JSON.stringify(["#3a7bd5", "#ff6b6b", "#2ecc71"])\n));\n// [{ hex, oklch, hct, luminance }, ...]' },
  { mod:'agent', type:'class', name:'AgentExecutor', sig:'new AgentExecutor()', desc:'Low-level JSON query executor. Method: execute(queryJson)â†’JSON string. Accepts any agent query in JSON format (validate, recommend, material, etc.). ContractBuilder is the preferred high-level alternative.', example:'const exec = new AgentExecutor();\nconst result = exec.execute(JSON.stringify({\n  action: "validate",\n  color: "#5577cc",\n  contract: new ContractBuilder().minContrastWcagAA("#07070e").build()\n}));' },
  { mod:'agent', type:'class', name:'ContractBuilder', sig:'new ContractBuilder()', desc:'Fluent color contract builder. Chainable: minContrastWcagAA(against), minContrastWcagAAA(against), inSrgb(), inP3(), lightnessRange(min,max), chromaRange(min,max), hueRange(min,max). Methods: build()â†’JSON, buildAndValidate(colorHex).', example:'const contract = new ContractBuilder()\n  .minContrastWcagAA("#07070e")\n  .lightnessRange(0.4, 0.9)\n  .inSrgb()\n  .build(); // JSON string\nagentValidate("#6188d8", contract);' },
];

const QS_EXAMPLES = [
  { title:'WCAG AA Compliance', desc:'Check contrast ratio', code:`import init, { Color, wcagContrastRatio, wcagPasses } from 'momoto-wasm';
await init();
const fg = Color.fromHex('#1a1a2e');
const bg = Color.fromHex('#f0f4ff');
const ratio = wcagContrastRatio(fg, bg);
const aa = wcagPasses(ratio, 0, false);
console.log(\`\${ratio.toFixed(2)}:1 â€” AA: \${aa}\`);` },
  { title:'HCT Tonal Palette (MD3)', desc:'13-tone Material Design 3 palette', code:`import init, { hexToHct, hctTonalPalette, hctToHex } from 'momoto-wasm';
await init();
const [hue, chroma] = hexToHct('#3a7bd5');
const pal = hctTonalPalette(hue, chroma);
const tones = [0,10,20,30,40,50,60,70,80,90,95,99,100];
for (let i = 0; i < 13; i++) {
  const hex = hctToHex(pal[i*3], pal[i*3+1], pal[i*3+2]);
  console.log(\`Tone \${tones[i]}: \${hex}\`);
}` },
  { title:'Cook-Torrance BRDF', desc:'Physical specular reflectance (PBR)', code:`import init, { cookTorranceBRDF } from 'momoto-wasm';
await init();
const brdf = cookTorranceBRDF(
  new Float64Array([0, 1, 0]),     // surface normal
  new Float64Array([0, 1, 0]),     // view direction
  new Float64Array([0.7, 0.7, 0]), // light direction
  0.2, 1.5, 0.8                   // roughness, IOR, cosTheta
);
console.log(\`Specular: \${brdf.toFixed(4)}\`);` },
  { title:'CVD Simulation', desc:'Simulate protanopia color blindness', code:`import init, { simulateCVD, cvdDeltaE } from 'momoto-wasm';
await init();
const original = '#3a7bd5';
const simulated = simulateCVD(original, 'protanopia', 1.0);
const deltaE = cvdDeltaE(original, 'protanopia');
console.log('Original: ', original);
console.log('Simulated:', simulated);
console.log('Î”E OKLab: ', deltaE.toFixed(3));` },
  { title:'Soap Bubble Timeline', desc:'Animate thin-film iridescence at 60fps', code:`import init, { TemporalThinFilmMaterial } from 'momoto-wasm';
await init();
const bubble = TemporalThinFilmMaterial.soapBubble();
// 3 seconds at 60fps = 180 samples
const timeline = bubble.sampleTimeline(3.0, 180, 0.8);
for (let i = 0; i < 10; i++) {
  const t = timeline[i*2];
  const r = timeline[i*2+1];
  console.log(\`t=\${t.toFixed(2)}s: R=\${r.toFixed(4)}\`);
}` },
  { title:'SIREN Neural Correction', desc:'Perceptual correction via neural network', code:`import init, { computeSirenCorrection, applySirenCorrection } from 'momoto-wasm';
await init();
const corr = computeSirenCorrection(
  0.15, 0.10, 250,   // background OKLCH
  0.55, 0.03, 250,   // foreground OKLCH
  75.0, 4.5, 65.0    // APCA Lc, WCAG ratio, quality
);
console.log('Î”L', corr.deltaL.toFixed(4), 'Î”C', corr.deltaC.toFixed(4), 'Î”H', corr.deltaH.toFixed(2) + 'Â°');
const [L, C, H] = applySirenCorrection(
  0.55, 0.03, 250, corr.deltaL, corr.deltaC, corr.deltaH
);` },
];

const ARCH_TEXT = `â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ momoto-wasm â”€â”€â”€ Public WASM API surface â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                            â”‚
â”‚  lib.rs          â† Sprint 1â€“4 physics: ThinFilm (12 presets),             â”‚
â”‚                    CauchyDispersion (7 presets), SellmeierDispersion,      â”‚
â”‚                    ComplexIOR (12 metals), SpectralComplexIOR, DrudeParams,â”‚
â”‚                    MieParams (9 presets), DynamicMieParams (8 presets),    â”‚
â”‚                    FilmLayer, TransferMatrixFilm (braggMirror),            â”‚
â”‚                    GlassMaterial, GlassMaterialBuilder, LiquidGlass        â”‚
â”‚                    ContactShadow, henyeyGreenstein, rayleighPhase, f0FromIORâ”‚
â”‚  hct.rs          â† HCT/CAM16 color space, tonal palettes                 â”‚
â”‚  core_ext.rs     â† OKLCH, OKLab, luminance, WCAG 2.1, APCA-W3 v0.1.9   â”‚
â”‚  intelligence.rs â† Recommendations, harmony (7 types), CVD (ViÃ©not 1999),â”‚
â”‚                    ConstraintSolver (penalty method, 6 constraint types)   â”‚
â”‚  materials_ext.rsâ† Refraction, lighting, AmbientShadow, ElevationTransitionâ”‚
â”‚                    RateLimiter, EMA, InterpolationMode, smoothstep/er,     â”‚
â”‚                    DielectricBSDF, ConductorBSDF, ThinFilmBSDF, Layered,  â”‚
â”‚                    PBRMaterial, FlickerValidator, ConstraintValidator       â”‚
â”‚  temporal.rs     â† TemporalMaterial, TemporalThinFilmMaterial,            â”‚
â”‚                    TemporalConductorMaterial + evalAtTime, sampleTimeline  â”‚
â”‚  procedural.rs   â† ProceduralNoise Perlin fBm, IOR variation fields      â”‚
â”‚  siren.rs        â† Neural [9â†’16â†’16â†’3], 483 params, Ï‰â‚€=30, seed=421337   â”‚
â”‚  events.rs       â† MomotoEventBus pub/sub + MomotoEventStream (SSE)      â”‚
â”‚  agent.rs        â† JSON API: validate, recommend, improve, certify        â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Rust Crates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  momoto-core        Color, OKLCH, OKLab, HCT/CAM16, gamma                â”‚
â”‚  momoto-metrics     WCAG 2.1 (AA=4.5:1/AAA=7:1), APCA-W3 v0.1.9        â”‚
â”‚  momoto-intelligence Harmony, CVD ViÃ©not 1999, constraint solver         â”‚
â”‚  momoto-materials   40+ physics files â€” Sprints 1â€“4:                     â”‚
â”‚    â”œ Sprint 1: ThinFilm, Airy formula, 12 presets                        â”‚
â”‚    â”œ Sprint 2: CauchyDispersion, Sellmeier, ComplexIOR, 12 metal presets â”‚
â”‚    â”œ Sprint 3: MieParams, 9 presets, henyeyGreenstein, rayleighPhase     â”‚
â”‚    â”” Sprint 4: FilmLayer, TransferMatrixFilm, braggMirror                â”‚
â”‚  momoto-agent       Contracts, workflows, self-certification              â”‚
â”‚  momoto-events      EventBus (pub/sub), EventStream (SSE-compatible)     â”‚
â”‚  momoto-engine      (stub â€” future SIMD/batch performance layer)         â”‚
â”‚                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TypeScript (src/) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  domain/        Color entities, tokens, perceptual value objects          â”‚
â”‚  application/   Use cases: generate palette, validate contrast, export    â”‚
â”‚  adapters/      React, Angular, Vue, Svelte, CSS, Tailwind                â”‚
â”‚  infrastructure/ WASM bridge (MomotoBridge.ts), W3C token exporter       â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜`;

// â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderArch() {
  document.getElementById('arch-diagram').textContent = ARCH_TEXT;
}

function renderModules() {
  document.getElementById('modules-grid').innerHTML = MODULES.map(m => `
    <div class="module-card" onclick="filterByMod('${m.key}')">
      <div class="module-icon">${m.icon}</div>
      <h3>${m.name}</h3>
      <p>${m.desc}</p>
      <span class="module-count">${m.fns} functions</span>
    </div>`).join('');
}

function renderPills() {
  const pills = [['all','All'], ...MODULES.map(m => [m.key, m.name.split(' ')[0]])];
  document.getElementById('filter-pills').innerHTML = pills.map(([k,l]) =>
    `<button class="pill${k==='all'?' active':''}" onclick="filterByMod('${k}')">${l}</button>`
  ).join('');
}

function renderQS() {
  document.getElementById('qs-grid').innerHTML = QS_EXAMPLES.map((ex,i) => `
    <div class="qs-card">
      <div class="qs-header">
        <span class="qs-num">${i+1}</span>
        <span class="qs-title">${ex.title}</span>
        <span class="qs-desc">${ex.desc}</span>
      </div>
      <div class="code-block" style="border-radius:0;border:none;border-top:1px solid var(--m-border)">
        <button class="copy-btn" onclick="copyCode(this,'${escAttr(ex.code)}')">copy</button>
        <pre style="white-space:pre-wrap">${escHtml(ex.code)}</pre>
      </div>
    </div>`).join('');
}

let currentMod = 'all';
let currentQ   = '';

function renderAPI() {
  const items = API_ITEMS.filter(item => {
    if (currentMod !== 'all' && item.mod !== currentMod) return false;
    if (currentQ) {
      const q = currentQ.toLowerCase();
      return item.name.toLowerCase().includes(q) ||
             item.sig.toLowerCase().includes(q) ||
             item.desc.toLowerCase().includes(q);
    }
    return true;
  });

  if (!items.length) {
    document.getElementById('api-grid').innerHTML = '<p style="color:var(--m-text-3);padding:2rem">No results. Try a different search.</p>';
    return;
  }

  document.getElementById('api-grid').innerHTML = items.map((item,i) => {
    const coloredSig = item.sig
      .replace(/^([A-Z][a-zA-Z]+)\./, '<span class="sig-class">$1</span>.')
      .replace(/^([a-z][a-zA-Z]+)(\(|$)/, '<span class="sig-name">$1</span>$2');

    const paramsHtml = item.params ? `
      <div class="api-params">
        <div class="api-params-title">Parameters</div>
        ${Object.entries(item.params).map(([k,v]) =>
          `<div class="param-row"><span class="param-name">${k}</span><span class="param-desc">${v}</span></div>`
        ).join('')}
      </div>` : '';

    const exCode = item.example || '';

    return `
      <div class="api-card" id="card-${i}">
        <div class="api-card-header" onclick="toggleCard('card-${i}')">
          <span class="type-pill type-${item.type}">${item.type}</span>
          <span class="api-sig">${coloredSig}</span>
          <span class="api-desc-short">${item.desc.slice(0,60)}${item.desc.length>60?'â€¦':''}</span>
          <span class="chevron">â€º</span>
        </div>
        <div class="api-card-body">
          <p class="api-full-desc">${item.desc}</p>
          ${item.note ? `<p class="api-note">â“˜ ${item.note}</p>` : ''}
          ${paramsHtml}
          ${item.returns ? `<div class="api-returns"><span class="returns-label">Returns</span><span class="returns-val">${item.returns}</span></div>` : ''}
          ${item.standard ? `<div class="api-standard">Standard: ${item.standard}</div>` : ''}
          ${exCode ? `<div class="code-block" style="margin-top:0.75rem">
            <button class="copy-btn" onclick="copyCode(this,'${escAttr(exCode)}')">copy</button>
            <pre style="white-space:pre-wrap">${escHtml(exCode)}</pre>
          </div>` : ''}
        </div>
      </div>`;
  }).join('');
}

// â”€â”€ PIPELINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function toggleStep(id) {
  const el = document.getElementById(id);
  const wasActive = el.classList.contains('active');
  document.querySelectorAll('.pipeline-step').forEach(s => s.classList.remove('active'));
  if (!wasActive) el.classList.add('active');
}

// â”€â”€ CODE VIEWER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function showCodePanel(panelId, btn) {
  document.querySelectorAll('.code-panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.code-tab').forEach(t => t.classList.remove('active'));
  document.getElementById(panelId).classList.add('active');
  btn.classList.add('active');
}

// â”€â”€ INTERACTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function toggleCard(id) {
  document.getElementById(id).classList.toggle('open');
}

function filterByMod(mod) {
  currentMod = mod;
  document.querySelectorAll('.pill').forEach(p => p.classList.toggle('active', p.textContent.toLowerCase().trim() === (mod === 'all' ? 'all' : MODULES.find(m=>m.key===mod)?.name.split(' ')[0].toLowerCase() || mod)));
  document.getElementById('search').value = '';
  currentQ = '';
  renderAPI();
  document.getElementById('api').scrollIntoView({ behavior:'smooth', block:'start' });
}

function onSearch(q) {
  currentQ = q;
  renderAPI();
}

function openModal(src, alt) {
  const modal = document.getElementById('modal');
  const img   = document.getElementById('modal-img');
  img.src = src; img.alt = alt;
  modal.classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  document.getElementById('modal').classList.remove('open');
  document.body.style.overflow = '';
}

document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

function copyCode(btn, code) {
  navigator.clipboard.writeText(code).then(() => {
    btn.textContent = 'âœ“ copied';
    setTimeout(() => btn.textContent = 'copy', 1500);
  });
}

function escHtml(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function escAttr(s) { return s.replace(/"/g,'&quot;').replace(/\n/g,'\\n').replace(/'/g,"\\'"); }

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

renderArch();
renderModules();
renderPills();
renderQS();
renderAPI();
</script>
</body>
</html>
